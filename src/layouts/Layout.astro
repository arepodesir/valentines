---
import { ViewTransitions } from "astro:transitions";
import "../styles/global.css";

import { t, type Lang, LANGUAGES } from "../lib/i18n";

interface Props {
    title: string;
    description?: string;
    lang?: Lang;
}

const {
    title,
    description = "Remark: The Perpetual Message Bridge",
    lang = "en",
} = Astro.props;

// Also detect from URL if not passed prop
const currentLang = (lang ||
    Astro.url.searchParams.get("lang") ||
    "en") as Lang;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title}</title>
        <ViewTransitions />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap"
            rel="stylesheet"
        />
    </head>
    <body
        class="bg-[#050505] text-[#FDFBF7] overflow-x-hidden selection:bg-[#D4AF37]/30 selection:text-[#1A1A1A]"
    >
        <!-- Navigation -->
        <nav
            class="fixed top-6 left-1/2 -translate-x-1/2 z-50 transition-all duration-500 transform"
            id="main-nav"
        >
            <div
                class="glass-panel px-8 py-3 rounded-full flex items-center gap-8 shadow-2xl backdrop-blur-xl bg-[#050505]/60 hover:border-[#D4AF37]/40 transition-colors"
            >
                <a
                    href="/"
                    class="font-serif font-bold text-xl tracking-tight text-[#D4AF37] hover:text-[#FDFBF7] transition-colors relative group"
                >
                    Remark
                    <span
                        class="absolute -bottom-1 left-0 w-0 h-[1px] bg-[#D4AF37] transition-all group-hover:w-full"
                    ></span>
                </a>
                <div class="h-4 w-px bg-[#D4AF37]/20"></div>
                <div
                    class="flex items-center gap-6 text-sm font-medium text-[#FDFBF7]/70"
                >
                    <a
                        href={`/create?lang=${currentLang}`}
                        class="hover:text-[#D4AF37] transition-colors"
                        >{t("nav.create", currentLang)}</a
                    >
                    <a
                        href="/docs/manifesto"
                        class="hover:text-[#D4AF37] transition-colors"
                        >{t("nav.docs", currentLang)}</a
                    >
                </div>
            </div>
        </nav>

        <slot />

        <script>
            // Auto-hide nav on scroll
            let lastScroll = 0;
            const nav = document.getElementById("main-nav");

            window.addEventListener("scroll", () => {
                const currentScroll = window.scrollY;
                if (currentScroll > lastScroll && currentScroll > 100) {
                    nav?.classList.add("-translate-y-32");
                } else {
                    nav?.classList.remove("-translate-y-32");
                }
                lastScroll = currentScroll;
            });
        </script>
    </body>
</html>
