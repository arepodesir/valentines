<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="Under the hood of Hearth: Effect.ts, Three.js, and FSM-driven logic."><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Architecture - Heirloom Docs</title><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/_slug_.B8Xe5oN4.css">
<style>.intro[data-astro-cid-uyvx2lj4]{font-size:1.1em;line-height:1.6;color:#ffffffe6;margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid rgba(255,255,255,.1)}h2[data-astro-cid-uyvx2lj4]{color:var(--color-accent);font-family:Playfair Display,serif;margin-top:3rem;margin-bottom:1rem}h3[data-astro-cid-uyvx2lj4]{font-family:Playfair Display,serif}strong[data-astro-cid-uyvx2lj4]{color:var(--color-gold)}ul[data-astro-cid-uyvx2lj4]{padding-left:1rem;list-style:none}li[data-astro-cid-uyvx2lj4]{margin-bottom:.5rem;position:relative}li[data-astro-cid-uyvx2lj4]:before{content:"•";color:var(--color-accent);position:absolute;left:-1rem}
</style>
<link rel="stylesheet" href="/_astro/architecture.N0agx_PU.css"><script type="module" src="/_astro/hoisted.1FdYwair.js"></script></head> <body class="bg-[#050505] text-[#FDFBF7] overflow-x-hidden selection:bg-[#D4AF37]/30 selection:text-[#1A1A1A]"> <!-- Navigation --> <nav class="fixed top-6 left-1/2 -translate-x-1/2 z-50 transition-all duration-500 transform" id="main-nav"> <div class="glass-panel px-8 py-3 rounded-full flex items-center gap-8 shadow-2xl backdrop-blur-xl bg-[#050505]/60 hover:border-[#D4AF37]/40 transition-colors"> <a href="/" class="font-serif font-bold text-xl tracking-tight text-[#D4AF37] hover:text-[#FDFBF7] transition-colors relative group">
Remark
<span class="absolute -bottom-1 left-0 w-0 h-[1px] bg-[#D4AF37] transition-all group-hover:w-full"></span> </a> <div class="h-4 w-px bg-[#D4AF37]/20"></div> <div class="flex items-center gap-6 text-sm font-medium text-[#FDFBF7]/70"> <a href="/create?lang=en" class="hover:text-[#D4AF37] transition-colors">Compose</a> <a href="/docs/manifesto" class="hover:text-[#D4AF37] transition-colors">Manifesto</a> </div> </div> </nav>  <div class="max-w-4xl mx-auto px-6 py-24 min-h-screen relative z-10"> <!-- Breadcrumb --> <div class="flex items-center gap-3 text-sm text-[#FDFBF7]/40 mb-12 font-mono tracking-widest uppercase"> <a href="/" class="hover:text-[#D4AF37] transition-colors border-b border-transparent hover:border-[#D4AF37]">Heirloom</a> <span class="text-[#D4AF37]">/</span> <a href="/docs/roadmap" class="hover:text-[#D4AF37] transition-colors border-b border-transparent hover:border-[#D4AF37]">Archives</a>  <span class="text-[#D4AF37]">/</span> <span class="text-[#D4AF37] font-bold"> Architecture </span>  </div> <!-- Header --> <header class="mb-16 border-b border-[#D4AF37]/20 pb-8"> <div class="flex items-center gap-6 mb-6"> <span class="text-5xl animate-float filter drop-shadow-[0_0_15px_rgba(212,175,55,0.3)]"> ⚙️ </span> <h1 class="text-6xl font-serif font-bold text-[#FDFBF7] tracking-tight"> Architecture </h1> </div> <p class="text-2xl text-[#FDFBF7]/70 leading-relaxed max-w-2xl font-serif italic"> Under the hood of Hearth: Effect.ts, Three.js, and FSM-driven logic. </p> </header> <!-- Content --> <article class="prose prose-invert prose-lg max-w-none
      prose-headings:font-serif prose-headings:text-[#D4AF37]
      prose-p:text-[#FDFBF7]/80 prose-p:font-sans prose-p:leading-relaxed
      prose-a:text-[#D4AF37] hover:prose-a:text-[#E5C56C] prose-a:transition-colors
      prose-strong:text-[#FDFBF7] prose-code:text-[#D4AF37] prose-pre:border prose-pre:border-[#D4AF37]/20">  <div class="intro" data-astro-cid-uyvx2lj4> <p data-astro-cid-uyvx2lj4>
Hearth is built on a modern, type-safe stack designed for
            performance, correctness, and longevity. We use Functional
            Programming (FP) principles to ensure the core logic is robust, and
            a component-based approach for UI flexibility.
</p> </div> <h2 data-astro-cid-uyvx2lj4>1. Technology Stack</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8" data-astro-cid-uyvx2lj4> <div class="glass-panel p-6 border border-white/10 rounded-xl" data-astro-cid-uyvx2lj4> <h3 class="text-xl font-bold text-accent mb-2" data-astro-cid-uyvx2lj4>Frontend Core</h3> <ul class="text-sm text-white/70 space-y-1" data-astro-cid-uyvx2lj4> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Astro</strong>: Static Site Generation (SSG) for
                    fast routing and zero-JS initial load.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>SolidJS</strong>: High-performance, fine-grained
                    reactivity for UI islands.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>TailwindCSS</strong>: Utility-first styling with
                    custom plugin system.
</li> </ul> </div> <div class="glass-panel p-6 border border-white/10 rounded-xl" data-astro-cid-uyvx2lj4> <h3 class="text-xl font-bold text-accent mb-2" data-astro-cid-uyvx2lj4>Engine</h3> <ul class="text-sm text-white/70 space-y-1" data-astro-cid-uyvx2lj4> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Three.js</strong>: WebGL renderer for the 3D Music
                    Box scene.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>GSAP</strong>: Timeline-based animation
                    orchestration.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Effect.ts</strong>: Functional error handling,
                    dependency injection, and resource management.
</li> </ul> </div> </div> <h2 data-astro-cid-uyvx2lj4>2. The FSM Config Parser</h2> <p data-astro-cid-uyvx2lj4>
At the heart of Hearth is the <code data-astro-cid-uyvx2lj4>.conf</code> format — a simple, human-readable
        INI dialect that defines universal message parameters. We parse this using
        a strict <strong data-astro-cid-uyvx2lj4>Finite State Machine (FSM)</strong>.
</p> <pre class="bg-black/40 p-4 rounded-lg text-xs font-mono text-white/80 overflow-x-auto border border-white/10" data-astro-cid-uyvx2lj4>// State Definitions
type FSMState = 'IDLE' | 'SECTION' | 'KV';

// Transitions
IDLE -> SECTION ("[header]")
SECTION -> KV (key=value)
KV -> KV (key=value)
KV -> SECTION ("[header]")
</pre> <p data-astro-cid-uyvx2lj4>
This ensures that invalid configs fail gracefully with precise line
        numbers, and allows us to extend the schema without breaking legacy
        parsers.
</p> <h2 data-astro-cid-uyvx2lj4>3. Reactivity Model</h2> <p data-astro-cid-uyvx2lj4>
Hearth uses SolidJS signals for state management. The <code data-astro-cid-uyvx2lj4>App.tsx</code> component orchestrates the entire lifecycle:
</p> <ol class="list-decimal pl-5 space-y-2 mt-4 text-white/70" data-astro-cid-uyvx2lj4> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Loading Phase</strong>: Parallel fetch of config, audio, and
            texture assets.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Envelope Phase</strong>: Static HTML/CSS envelope
            interactive layer.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Scene Phase</strong>: 3D Canvas initialization. The <code data-astro-cid-uyvx2lj4>MusicBoxScene</code> class manages its own Three.js render loop but reacts to Solid props.
</li> <li data-astro-cid-uyvx2lj4> <strong data-astro-cid-uyvx2lj4>Finale Phase</strong>: Cleanup of WebGL context and
            transition to end card.
</li> </ol> <h2 data-astro-cid-uyvx2lj4>4. Decentralized Future</h2> <p data-astro-cid-uyvx2lj4>
We are decoupling the data from the presentation logic. A Hearth message
        is just a JSON/Config object. This object can live on:
</p> <ul data-astro-cid-uyvx2lj4> <li data-astro-cid-uyvx2lj4>LocalStorage (Drafts)</li> <li data-astro-cid-uyvx2lj4>Static Files (Current)</li> <li data-astro-cid-uyvx2lj4>IPFS / Arweave (Immutable)</li> <li data-astro-cid-uyvx2lj4>GunDB / P2P (Live Collaboration)</li> </ul> <p data-astro-cid-uyvx2lj4>
The renderer (this app) is just a viewer for that data. This
        "Viewer/Data Separation" ensures that messages can outlive the platform
        itself.
</p>  </article> <!-- Footer --> <footer class="mt-24 pt-12 border-t border-[#D4AF37]/10 text-center text-[#FDFBF7]/30 text-xs font-mono tracking-widest uppercase"> <p>
&copy; 2026 Heirloom Protocol. Permanent Digital
                Artifacts.
</p> </footer> </div>   </body> </html> 