const nl=t=>typeof t=="function",u=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(i){return e(i,n,r)}};case 4:return function(n,r,s,i){return arguments.length>=4?e(n,r,s,i):function(o){return e(o,n,r,s)}};case 5:return function(n,r,s,i,o){return arguments.length>=5?e(n,r,s,i,o):function(c){return e(c,n,r,s,i)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},U=t=>t,hr=t=>()=>t,Ki=hr(!0),Xr=hr(!1),Go=hr(void 0),rl=Go;function f(t,e,n,r,s,i,o,c,a){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return i(s(r(n(e(t)))));case 7:return o(i(s(r(n(e(t))))));case 8:return c(o(i(s(r(n(e(t)))))));case 9:return a(c(o(i(s(r(n(e(t))))))));default:{let l=arguments[0];for(let d=1;d<arguments.length;d++)l=arguments[d](l);return l}}}const xs=t=>(e,n)=>e===n||t(e,n),sl=u(2,(t,e)=>xs((n,r)=>t(e(n),e(r)))),il=t=>xs((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}),Ji="effect/GlobalValue";let Be;const R=(t,e)=>(Be||(globalThis[Ji]??=new Map,Be=globalThis[Ji]),Be.has(t)||Be.set(t,e()),Be.get(t)),ol=t=>typeof t=="string",Zr=t=>typeof t=="number",cl=t=>typeof t=="bigint",dr=nl,al=t=>typeof t=="object"&&t!==null,pr=t=>al(t)||dr(t),O=u(2,(t,e)=>pr(t)&&e in t),Wo=u(2,(t,e)=>O(t,"_tag")&&t._tag===e),ne=t=>t==null,ul=t=>O(t,"then")&&dr(t.then),gr=t=>`BUG: ${t} - please report an issue at https://github.com/Effect-TS/effect/issues`;let Yo=class zo{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new zo(this.self)}};const ll=335903614,fl=4150755663,hl=1481765933,dl=1284865837,pl=9007199254740992,gl=134217728;class ml{_state;constructor(e,n,r,s){return ne(n)&&ne(e)?(n=Math.random()*4294967295>>>0,e=0):ne(n)&&(n=e,e=0),ne(s)&&ne(r)?(s=this._state?this._state[3]:fl,r=this._state?this._state[2]:ll):ne(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),Hi(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*gl+n)/pl}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;_l(this._state,e,n,hl,dl),Hi(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const i=(s>>>27|r<<5)>>>0,o=e>>>27,c=(-o>>>0&31)>>>0;return(i>>>o|i<<c)>>>0}}function _l(t,e,n,r,s){let i=(n>>>16)*(s&65535)>>>0,o=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((o>>>16)+(i>>>16))>>>0;o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(a=a+1>>>0),i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(e,s)>>>0,t[0]=a,t[1]=c}function Hi(t,e,n,r,s){let i=e+r>>>0;const o=n+s>>>0;o>>>0<n>>>0&&(i=i+1|0),t[0]=i,t[1]=o}const ts=Symbol.for("effect/Utils/YieldWrap");class an{#t;constructor(e){this.#t=e}[ts](){return this.#t}}function yl(t){if(typeof t=="object"&&t!==null&&ts in t)return t[ts]();throw new Error(gr("yieldWrapGet"))}const st=R("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Qo={effect_internal_function:t=>t()},bl={effect_internal_function:t=>{try{return t()}finally{}}},Sl=Qo.effect_internal_function(()=>new Error().stack)?.includes("effect_internal_function")===!0,z=Sl?Qo.effect_internal_function:bl.effect_internal_function,qr=R(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),w=Symbol.for("effect/Hash"),_=t=>{if(st.enabled===!0)return 0;switch(typeof t){case"number":return Ls(t);case"bigint":return x(t.toString(10));case"boolean":return x(String(t));case"symbol":return x(String(t));case"string":return x(t);case"undefined":return x("undefined");case"function":case"object":return t===null?x("null"):t instanceof Date?Number.isNaN(t.getTime())?x("Invalid Date"):_(t.toISOString()):t instanceof URL?_(t.href):kl(t)?t[w]():js(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},js=t=>(qr.has(t)||qr.set(t,Ls(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),qr.get(t)),E=t=>e=>e*53^t,mr=t=>t&3221225471|t>>>1&1073741824,kl=t=>O(t,w),Ls=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return mr(e)},x=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return mr(e)},vl=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=f(x(e[r]),E(_(t[e[r]])));return mr(n)},Xo=t=>vl(t,Object.keys(t)),un=t=>{let e=6151;for(let n=0;n<t.length;n++)e=f(e,E(_(t[n])));return mr(e)},N=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,w,{value(){return r},enumerable:!1}),r}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,w,{value(){return e},enumerable:!1}),e},k=Symbol.for("effect/Equal");function v(){return arguments.length===1?t=>Vn(t,arguments[0]):Vn(arguments[0],arguments[1])}function Vn(t,e){if(t===e)return!0;const n=typeof t;if(n!==typeof e)return!1;if(n==="object"||n==="function"){if(t!==null&&e!==null){if(Kn(t)&&Kn(e))return _(t)===_(e)&&t[k](e)?!0:st.enabled&&st.tester?st.tester(t,e):!1;if(t instanceof Date&&e instanceof Date){const r=t.getTime(),s=e.getTime();return r===s||Number.isNaN(r)&&Number.isNaN(s)}else if(t instanceof URL&&e instanceof URL)return t.href===e.href}if(st.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every((r,s)=>Vn(r,e[s]));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(t),s=Object.keys(e);if(r.length===s.length){for(const i of r)if(!(i in e&&Vn(t[i],e[i])))return st.tester?st.tester(t,e):!1;return!0}}return st.tester?st.tester(t,e):!1}}return st.enabled&&st.tester?st.tester(t,e):!1}const Kn=t=>O(t,k),Ds=()=>v,A=Symbol.for("nodejs.util.inspect.custom"),q=t=>{try{if(O(t,"toJSON")&&dr(t.toJSON)&&t.toJSON.length===0)return t.toJSON();if(Array.isArray(t))return t.map(q)}catch{return{}}return Il(t)},V=t=>JSON.stringify(t,null,2),ue=(t,e=2)=>{if(typeof t=="string")return t;try{return typeof t=="object"?Zo(t,e):String(t)}catch{return String(t)}},Zo=(t,e)=>{let n=[];const r=JSON.stringify(t,(s,i)=>typeof i=="object"&&i!==null?n.includes(i)?void 0:n.push(i)&&(Jt.fiberRefs!==void 0&&tc(i)?i[qs](Jt.fiberRefs):i):i,e);return n=void 0,r},qs=Symbol.for("effect/Inspectable/Redactable"),tc=t=>typeof t=="object"&&t!==null&&qs in t,Jt=R("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),wl=(t,e)=>{const n=Jt.fiberRefs;Jt.fiberRefs=t;try{return e()}finally{Jt.fiberRefs=n}},Il=t=>tc(t)&&Jt.fiberRefs!==void 0?t[qs](Jt.fiberRefs):t,y=(t,e)=>{switch(e.length){case 0:return t;case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},Ye="Async",_r="Commit",at="Failure",Ur="OnFailure",Jn="OnSuccess",Hn="OnSuccessAndFailure",ut="Success",ec="Sync",Ol="Tag",ln="UpdateRuntimeFlags",Gn="While",An="Iterator",nc="WithRuntime",Pn="Yield",Us="RevertFlags";let El="3.19.17";const Bs=()=>El,$l=Symbol.for("effect/Effect"),Ml=Symbol.for("effect/Stream"),Rl=Symbol.for("effect/Sink"),Tl=Symbol.for("effect/Channel"),le={_R:t=>t,_E:t=>t,_A:t=>t,_V:Bs()},Fl={_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},Cl={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},fn={[$l]:le,[Ml]:le,[Rl]:Fl,[Tl]:Cl,[k](t){return this===t},[w](){return N(this,js(this))},[Symbol.iterator](){return new Yo(new an(this))},pipe(){return y(this,arguments)}},Vs={[w](){return N(this,Xo(this))},[k](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&v(this[r],t[r])))return!1;return!0}},hn={...fn,_op:_r},Nl={...hn,...Vs},Al=function(){function t(){}return t.prototype=hn,t}(),rc=Symbol.for("effect/Option"),sc={...fn,[rc]:{_A:t=>t},[A](){return this.toJSON()},toString(){return V(this.toJSON())}},Pl=Object.assign(Object.create(sc),{_tag:"Some",_op:"Some",[k](t){return ic(t)&&cc(t)&&v(this.value,t.value)},[w](){return N(this,E(_(this._tag))(_(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:q(this.value)}}}),xl=_("None"),jl=Object.assign(Object.create(sc),{_tag:"None",_op:"None",[k](t){return ic(t)&&oc(t)},[w](){return xl},toJSON(){return{_id:"Option",_tag:this._tag}}}),ic=t=>O(t,rc),oc=t=>t._tag==="None",cc=t=>t._tag==="Some",ac=Object.create(jl),es=t=>{const e=Object.create(Pl);return e.value=t,e},uc=Symbol.for("effect/Either"),lc={...fn,[uc]:{_R:t=>t},[A](){return this.toJSON()},toString(){return V(this.toJSON())}},Ll=Object.assign(Object.create(lc),{_tag:"Right",_op:"Right",[k](t){return fc(t)&&dc(t)&&v(this.right,t.right)},[w](){return E(_(this._tag))(_(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:q(this.right)}}}),Dl=Object.assign(Object.create(lc),{_tag:"Left",_op:"Left",[k](t){return fc(t)&&hc(t)&&v(this.left,t.left)},[w](){return E(_(this._tag))(_(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:q(this.left)}}}),fc=t=>O(t,uc),hc=t=>t._tag==="Left",dc=t=>t._tag==="Right",ql=t=>{const e=Object.create(Dl);return e.left=t,e},Ul=t=>{const e=Object.create(Ll);return e.right=t,e},Mt=Ul,fe=ql,We=hc,$n=dc,Bl=u(2,(t,{onLeft:e,onRight:n})=>We(t)?e(t.left):n(t.right)),Vl=Bl({onLeft:U,onRight:U}),pc=t=>t.length>0,gc=t=>(e,n)=>e===n?0:t(e,n),Kl=gc((t,e)=>t<e?-1:1),Jl=u(2,(t,e)=>gc((n,r)=>t(e(n),e(r)))),Hl=t=>u(2,(e,n)=>t(e,n)===1),S=()=>ac,M=es,Q=oc,St=cc,Ks=u(2,(t,{onNone:e,onSome:n})=>Q(t)?e():n(t.value)),Wt=u(2,(t,e)=>Q(t)?e():t.value),Gl=u(2,(t,e)=>Q(t)?M(e()):t),Js=t=>t==null?S():M(t),Dt=Wt(Go),Wl=u(2,(t,e)=>Q(t)?S():M(e(t.value))),Yl=u(2,(t,e)=>Q(t)?S():e(t.value)),zl=t=>u(2,(e,n)=>Q(e)?!1:t(e.value,n)),Ql=Ds(),Xl=zl(Ql),Zl=(...t)=>t,Hs=t=>new Array(t),tf=u(2,(t,e)=>{const n=Math.max(1,Math.floor(t)),r=new Array(n);for(let s=0;s<n;s++)r[s]=e(s);return r}),B=t=>Array.isArray(t)?t:Array.from(t),ef=t=>Array.isArray(t)?t:[t],Wn=u(2,(t,e)=>[e,...t]),nf=u(2,(t,e)=>[...t,e]),mc=u(2,(t,e)=>B(t).concat(B(e))),rf=t=>t.length===0,sf=rf,of=pc,tt=pc,_c=(t,e)=>t<0||t>=e.length,cf=(t,e)=>Math.floor(Math.min(Math.max(0,t),e.length)),af=u(2,(t,e)=>{const n=Math.floor(e);return _c(n,t)?S():M(t[n])}),yc=u(2,(t,e)=>{const n=Math.floor(e);if(_c(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),ze=af(0),X=yc(0),uf=t=>tt(t)?M(bc(t)):S(),bc=t=>t[t.length-1],he=t=>t.slice(1),lf=(t,e)=>{let n=0;for(const r of t){if(!e(r,n))break;n++}return n},ff=u(2,(t,e)=>gf(t,lf(t,e))),hf=u(2,(t,e)=>{const n=B(t);return n.slice(cf(e,n),n.length)}),Gi=t=>Array.from(t).reverse(),Yn=u(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),Wi=u(2,(t,e)=>df(t,e,Zl)),df=u(3,(t,e,n)=>{const r=B(t),s=B(e);if(tt(r)&&tt(s)){const i=[n(X(r),X(s))],o=Math.min(r.length,s.length);for(let c=1;c<o;c++)i[c]=n(r[c],s[c]);return i}return[]}),pf=Ds(),gf=u(2,(t,e)=>{const n=Array.from(t),r=Math.floor(e);return tt(n)?r>=1?mf(n,r):[[],n]:[n,[]]}),mf=u(2,(t,e)=>{const n=Math.max(1,Math.floor(e));return n>=t.length?[_f(t),[]]:[Wn(t.slice(1,n),X(t)),t.slice(n)]}),_f=t=>t.slice(),yf=u(3,(t,e,n)=>{const r=B(t),s=B(e);return tt(r)?tt(s)?kc(n)(mc(r,s)):r:s}),xn=u(2,(t,e)=>yf(t,e,pf)),de=()=>[],ft=t=>[t],ie=u(2,(t,e)=>t.map(e)),bf=u(2,(t,e)=>{if(sf(t))return[];const n=[];for(let r=0;r<t.length;r++){const s=e(t[r],r);for(let i=0;i<s.length;i++)n.push(s[i])}return n}),Sf=bf(U),Sc=u(3,(t,e,n)=>B(t).reduce((r,s,i)=>n(r,s,i),e)),Yi=(t,e)=>{const n=[];let r=t,s;for(;St(s=e(r));){const[i,o]=s.value;n.push(i),r=o}return n},Gs=il,kc=u(2,(t,e)=>{const n=B(t);if(tt(n)){const r=[X(n)],s=he(n);for(const i of s)r.every(o=>!e(i,o))&&r.push(i);return r}return[]}),kf=t=>kc(t,Ds()),Te=u(2,(t,e)=>B(t).join(e)),Ze=Kl,vf=t=>t.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),wf=Symbol.for("effect/Context/Tag"),zn=Symbol.for("effect/Context/Reference"),If="effect/STM",Of=Symbol.for(If),vc={...fn,_op:"Tag",[Of]:le,[wf]:{_Service:t=>t,_Identifier:t=>t},toString(){return V(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[A](){return this.toJSON()},of(t){return t},context(t){return Pf(this,t)}},Ef={...vc,[zn]:zn},$f=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create(vc);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=t,r},Mf=()=>(t,e)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,Ef),s.key=t,s.defaultValue=e.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},wc=Symbol.for("effect/Context"),Rf={[wc]:{_Services:t=>t},[k](t){if(Ff(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!v(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[w](){return N(this,Ls(this.unsafeMap.size))},pipe(){return y(this,arguments)},toString(){return V(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(q)}},[A](){return this.toJSON()}},pe=t=>{const e=Object.create(Rf);return e.unsafeMap=t,e},Tf=t=>{const e=new Error(`Service not found${t.key?`: ${String(t.key)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},Ff=t=>O(t,wc),Cf=t=>O(t,zn),Nf=pe(new Map),Af=()=>Nf,Pf=(t,e)=>pe(new Map([[t.key,e]])),xf=u(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e.key,n),pe(r)}),Br=R("effect/Context/defaultValueCache",()=>new Map),Ws=t=>{if(Br.has(t.key))return Br.get(t.key);const e=t.defaultValue();return Br.set(t.key,e),e},jf=(t,e)=>t.unsafeMap.has(e.key)?t.unsafeMap.get(e.key):Ws(e),Ic=u(2,(t,e)=>{if(!t.unsafeMap.has(e.key)){if(zn in e)return Ws(e);throw Tf(e)}return t.unsafeMap.get(e.key)}),Lf=Ic,Df=u(2,(t,e)=>t.unsafeMap.has(e.key)?es(t.unsafeMap.get(e.key)):Cf(e)?es(Ws(e)):ac),qf=u(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return pe(n)}),Fe=$f,Ys=Af,Ve=xf,Oc=Lf,Ec=Ic,Uf=Df,Bf=qf,$c=Mf,Mc=Symbol.for("effect/Chunk");function Vf(t,e,n,r,s){for(let i=e;i<Math.min(t.length,e+s);i++)n[r+i-e]=t[i];return n}const Rc=[],Kf=t=>xs((e,n)=>e.length===n.length&&Ht(e).every((r,s)=>t(r,oe(n,s)))),Jf=Kf(v),Hf={[Mc]:{_A:t=>t},toString(){return V(this.toJSON())},toJSON(){return{_id:"Chunk",values:Ht(this).map(q)}},[A](){return this.toJSON()},[k](t){return Tc(t)&&Jf(this,t)},[w](){return N(this,un(Ht(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Rc[Symbol.iterator]();default:return Ht(this)[Symbol.iterator]()}},pipe(){return y(this,arguments)}},j=t=>{const e=Object.create(Hf);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=bt,e.right=bt;break}case"ISingleton":{e.length=1,e.depth=0,e.left=bt,e.right=bt;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=bt,e.right=bt;break}}return e},Tc=t=>O(t,Mc),bt=j({_tag:"IEmpty"}),Ft=()=>bt,Vr=(...t)=>Yf(t),et=t=>j({_tag:"ISingleton",a:t}),Fc=t=>Tc(t)?t:yr(B(t)),ns=(t,e,n)=>{switch(t.backing._tag){case"IArray":{Vf(t.backing.array,0,e,n,t.length);break}case"IConcat":{ns(t.left,e,n),ns(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=oe(t,r),r+=1,s+=1;break}}},Gf=t=>{switch(t.backing._tag){case"IEmpty":return Rc;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return ns(t,e,0),t.backing={_tag:"IArray",array:e},t.left=bt,t.right=bt,t.depth=0,e}}},Ht=Gf,Wf=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return j({_tag:"IArray",array:Gi(t.backing.array)});case"IConcat":return j({_tag:"IConcat",left:ge(t.backing.right),right:ge(t.backing.left)});case"ISlice":return yr(Gi(Ht(t)))}},ge=Wf,yr=t=>t.length===0?Ft():t.length===1?et(t[0]):j({_tag:"IArray",array:t}),Yf=t=>yr(t),oe=u(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?oe(t.left,e):oe(t.right,e-t.left.length);case"ISlice":return oe(t.backing.chunk,e+t.backing.offset)}}),zf=u(2,(t,e)=>ht(t,et(e))),pt=u(2,(t,e)=>ht(et(e),t)),rs=u(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return bt;switch(t.backing._tag){case"ISlice":return j({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?rs(t.right,e-t.left.length):j({_tag:"IConcat",left:rs(t.left,e),right:t.right});default:return j({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),ht=u(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return j({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=ht(t.right,e);return j({_tag:"IConcat",left:t.left,right:r})}else{const r=ht(t.right.right,e);if(r.depth===t.depth-3){const s=j({_tag:"IConcat",left:t.right.left,right:r});return j({_tag:"IConcat",left:t.left,right:s})}else{const s=j({_tag:"IConcat",left:t.left,right:t.right.left});return j({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=ht(t,e.left);return j({_tag:"IConcat",left:r,right:e.right})}else{const r=ht(t,e.left.left);if(r.depth===e.depth-3){const s=j({_tag:"IConcat",left:r,right:e.left.right});return j({_tag:"IConcat",left:s,right:e.right})}else{const s=j({_tag:"IConcat",left:e.left.right,right:e.right});return j({_tag:"IConcat",left:r,right:s})}}}),Qf=t=>t.length===0,me=t=>t.length>0,Cc=t=>oe(t,0),_e=Cc,Ut=t=>rs(t,1),ss=Symbol.for("effect/Duration"),Nc=BigInt(0),zi=BigInt(24),Mn=BigInt(60),is=BigInt(1e3),Qi=BigInt(1e6),Xi=BigInt(1e9),Xf=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,Ct=t=>{if(Ac(t))return t;if(Zr(t))return os(t);if(cl(t))return Kr(t);if(Array.isArray(t)&&t.length===2&&t.every(Zr))return t[0]===-1/0||t[1]===-1/0||Number.isNaN(t[0])||Number.isNaN(t[1])?Pc:t[0]===1/0||t[1]===1/0?nh:Kr(BigInt(Math.round(t[0]*1e9))+BigInt(Math.round(t[1])));if(ol(t)){const e=Xf.exec(t);if(e){const[n,r,s]=e,i=Number(r);switch(s){case"nano":case"nanos":return Kr(BigInt(r));case"micro":case"micros":return rh(BigInt(r));case"milli":case"millis":return os(i);case"second":case"seconds":return sh(i);case"minute":case"minutes":return ih(i);case"hour":case"hours":return oh(i);case"day":case"days":return ch(i);case"week":case"weeks":return ah(i)}}}throw new Error("Invalid DurationInput")},Zi={_tag:"Millis",millis:0},Zf={_tag:"Infinity"},th={[ss]:ss,[w](){return N(this,Xo(this.value))},[k](t){return Ac(t)&&gh(this,t)},toString(){return`Duration(${_h(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:lh(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},vt=t=>{const e=Object.create(th);return Zr(t)?isNaN(t)||t<=0?e.value=Zi:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=Zf:t<=Nc?e.value=Zi:e.value={_tag:"Nanos",nanos:t},e},Ac=t=>O(t,ss),eh=t=>{switch(t.value._tag){case"Millis":return t.value.millis===0;case"Nanos":return t.value.nanos===Nc;case"Infinity":return!1}},Pc=vt(0),nh=vt(1/0),Kr=t=>vt(t),rh=t=>vt(t*is),os=t=>vt(t),sh=t=>vt(t*1e3),ih=t=>vt(t*6e4),oh=t=>vt(t*36e5),ch=t=>vt(t*864e5),ah=t=>vt(t*6048e5),cs=t=>fh(t,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),uh=t=>{const e=Ct(t);switch(e.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return e.value.nanos;case"Millis":return BigInt(Math.round(e.value.millis*1e6))}},lh=t=>{const e=Ct(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/Xi),Number(e.value.nanos%Xi)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},fh=u(2,(t,e)=>{const n=Ct(t);switch(n.value._tag){case"Nanos":return e.onNanos(n.value.nanos);case"Infinity":return e.onMillis(1/0);case"Millis":return e.onMillis(n.value.millis)}}),zs=u(3,(t,e,n)=>{const r=Ct(t),s=Ct(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(cs(r),cs(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const i=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),o=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(i,o)}return n.onMillis(r.value.millis,s.value.millis)}),hh=(t,e)=>zs(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),dh=u(2,(t,e)=>zs(t,e,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),ph=u(2,(t,e)=>zs(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),gh=u(2,(t,e)=>hh(Ct(t),Ct(e))),mh=t=>{const e=Ct(t);if(e.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=uh(e),r=n/Qi,s=r/is,i=s/Mn,o=i/Mn,c=o/zi;return{days:Number(c),hours:Number(o%zi),minutes:Number(i%Mn),seconds:Number(s%Mn),millis:Number(r%is),nanos:Number(n%Qi)}},_h=t=>{const e=Ct(t);if(e.value._tag==="Infinity")return"Infinity";if(eh(e))return"0";const n=mh(e),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},Yt=5,Qs=Math.pow(2,Yt),yh=Qs-1,bh=Qs/2,Sh=Qs/4;function kh(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function ye(t,e){return e>>>t&yh}function se(t){return 1<<t}function xc(t,e){return kh(t&e-1)}const vh=(t,e)=>({value:t,previous:e});function ce(t,e,n,r){let s=r;if(!t){const i=r.length;s=new Array(i);for(let o=0;o<i;++o)s[o]=r[o]}return s[e]=n,s}function jc(t,e,n){const r=n.length-1;let s=0,i=0,o=n;if(t)s=i=e;else for(o=new Array(r);s<e;)o[i++]=n[s++];for(++s;s<=r;)o[i++]=n[s++];return t&&(o.length=r),o}function wh(t,e,n,r){const s=r.length;if(t){let a=s;for(;a>=e;)r[a--]=r[a];return r[e]=n,r}let i=0,o=0;const c=new Array(s+1);for(;i<e;)c[o++]=r[i++];for(c[e]=n;i<s;)c[++o]=r[i++];return c}class Pt{_tag="EmptyNode";modify(e,n,r,s,i,o){const c=r(S());return Q(c)?new Pt:(++o.value,new Gt(e,s,i,c))}}function dt(t){return Wo(t,"EmptyNode")}function Ih(t){return dt(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function br(t,e){return dt(t)?!1:e===t.edit}class Gt{edit;hash;key;value;_tag="LeafNode";constructor(e,n,r,s){this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,i,o){if(v(i,this.key)){const a=r(this.value);return a===this.value?this:Q(a)?(--o.value,new Pt):br(this,e)?(this.value=a,this):new Gt(e,s,i,a)}const c=r(S());return Q(c)?this:(++o.value,Lc(e,n,this.hash,this,s,new Gt(e,s,i,c)))}}class Xs{edit;hash;children;_tag="CollisionNode";constructor(e,n,r){this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,i,o){if(s===this.hash){const a=br(this,e),l=this.updateCollisionList(a,e,this.hash,this.children,r,i,o);return l===this.children?this:l.length>1?new Xs(e,this.hash,l):l[0]}const c=r(S());return Q(c)?this:(++o.value,Lc(e,n,this.hash,this,s,new Gt(e,s,i,c)))}updateCollisionList(e,n,r,s,i,o,c){const a=s.length;for(let d=0;d<a;++d){const h=s[d];if("key"in h&&v(o,h.key)){const p=h.value,g=i(p);return g===p?s:Q(g)?(--c.value,jc(e,d,s)):ce(e,d,new Gt(n,r,o,g),s)}}const l=i(S());return Q(l)?s:(++c.value,ce(e,a,new Gt(n,r,o,l),s))}}class be{edit;mask;children;_tag="IndexedNode";constructor(e,n,r){this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,i,o){const c=this.mask,a=this.children,l=ye(n,s),d=se(l),h=xc(c,d),p=c&d,g=br(this,e);if(!p){const J=new Pt().modify(e,n+Yt,r,s,i,o);return J?a.length>=bh?Eh(e,l,J,c,a):new be(e,c|d,wh(g,h,J,a)):this}const m=a[h],$=m.modify(e,n+Yt,r,s,i,o);if(m===$)return this;let F=c,K;if(dt($)){if(F&=~d,!F)return new Pt;if(a.length<=2&&Ih(a[h^1]))return a[h^1];K=jc(g,h,a)}else K=ce(g,h,$,a);return g?(this.mask=F,this.children=K,this):new be(e,F,K)}}class Zs{edit;size;children;_tag="ArrayNode";constructor(e,n,r){this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,i,o){let c=this.size;const a=this.children,l=ye(n,s),d=a[l],h=(d||new Pt).modify(e,n+Yt,r,s,i,o);if(d===h)return this;const p=br(this,e);let g;if(dt(d)&&!dt(h))++c,g=ce(p,l,h,a);else if(!dt(d)&&dt(h)){if(--c,c<=Sh)return Oh(e,c,l,a);g=ce(p,l,new Pt,a)}else g=ce(p,l,h,a);return p?(this.size=c,this.children=g,this):new Zs(e,c,g)}}function Oh(t,e,n,r){const s=new Array(e-1);let i=0,o=0;for(let c=0,a=r.length;c<a;++c)if(c!==n){const l=r[c];l&&!dt(l)&&(s[i++]=l,o|=1<<c)}return new be(t,o,s)}function Eh(t,e,n,r,s){const i=[];let o=r,c=0;for(let a=0;o;++a)o&1&&(i[a]=s[c++]),o>>>=1;return i[e]=n,new Zs(t,c+1,i)}function $h(t,e,n,r,s,i){if(n===s)return new Xs(t,n,[i,r]);const o=ye(e,n),c=ye(e,s);if(o===c)return a=>new be(t,se(o)|se(c),[a]);{const a=o<c?[r,i]:[i,r];return new be(t,se(o)|se(c),a)}}function Lc(t,e,n,r,s,i){let o,c=e;for(;;){const a=$h(t,c,n,r,s,i);if(typeof a=="function")o=vh(a,o),c=c+Yt;else{let l=a;for(;o!=null;)l=o.value(l),o=o.previous;return l}}}const Dc="effect/HashMap",as=Symbol.for(Dc),Mh={[as]:as,[Symbol.iterator](){return new Sr(this,(t,e)=>[t,e])},[w](){let t=_(Dc);for(const e of this)t^=f(_(e[0]),E(_(e[1])));return N(this,t)},[k](t){if(Fh(t)){if(t._size!==this._size)return!1;for(const e of this){const n=f(t,ei(e[0],_(e[0])));if(Q(n))return!1;if(!v(e[1],n.value))return!1}return!0}return!1},toString(){return V(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},ti=(t,e,n,r)=>{const s=Object.create(Mh);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class Sr{map;f;v;constructor(e,n){this.map=e,this.f=n,this.v=qc(this.map._root,this.f,void 0)}next(){if(Q(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=Qn(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new Sr(this.map,this.f)}}const Qn=t=>t?Uc(t[0],t[1],t[2],t[3],t[4]):S(),qc=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return St(t.value)?M({value:e(t.key,t.value.value),cont:n}):Qn(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return Uc(r.length,r,0,e,n)}default:return Qn(n)}},Uc=(t,e,n,r,s)=>{for(;n<t;){const i=e[n++];if(i&&!dt(i))return qc(i,r,[t,e,n,r,s])}return Qn(s)},Rh=ti(!1,0,new Pt,0),kr=()=>Rh,Th=t=>{const e=Vc(kr());for(const n of t)tn(e,n[0],n[1]);return xh(e)},Fh=t=>O(t,as),Ch=t=>t&&dt(t._root),Nh=u(2,(t,e)=>ei(t,e,_(e))),ei=u(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return v(e,r.key)?r.value:S();case"CollisionNode":{if(n===r.hash){const i=r.children;for(let o=0,c=i.length;o<c;++o){const a=i[o];if("key"in a&&v(e,a.key))return a.value}}return S()}case"IndexedNode":{const i=ye(s,n),o=se(i);if(r.mask&o){r=r.children[xc(r.mask,o)],s+=Yt;break}return S()}case"ArrayNode":{if(r=r.children[ye(s,n)],r){s+=Yt;break}return S()}default:return S()}}),Ah=u(2,(t,e)=>St(ei(t,e,_(e)))),tn=u(3,(t,e,n)=>ni(t,e,()=>M(n))),Ph=u(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:ti(t._editable,t._edit,e,n)),Bc=t=>new Sr(t,e=>e),us=t=>t._size,Vc=t=>ti(!0,t._edit+1,t._root,t._size),xh=t=>(t._editable=!1,t),ni=u(3,(t,e,n)=>jh(t,e,_(e),n)),jh=u(4,(t,e,n,r)=>{const s={value:t._size},i=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return f(t,Ph(i,s.value))}),to=u(2,(t,e)=>ni(t,e,S)),Lh=u(2,(t,e)=>vr(t,kr(),(n,r,s)=>tn(n,s,e(r,s)))),Dh=u(2,(t,e)=>vr(t,void 0,(n,r,s)=>e(r,s))),vr=u(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return St(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let i;for(;i=s.pop();)for(let o=0,c=i.length;o<c;){const a=i[o++];a&&!dt(a)&&(a._tag==="LeafNode"?St(a.value)&&(e=n(e,a.value.value,a.key)):s.push(a.children))}return e}),Kc="effect/HashSet",ls=Symbol.for(Kc),qh={[ls]:ls,[Symbol.iterator](){return Bc(this._keyMap)},[w](){return N(this,E(_(this._keyMap))(_(Kc)))},[k](t){return Uh(t)?us(this._keyMap)===us(t._keyMap)&&v(this._keyMap,t._keyMap):!1},toString(){return V(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},wr=t=>{const e=Object.create(qh);return e._keyMap=t,e},Uh=t=>O(t,ls),Bh=wr(kr()),Ir=()=>Bh,Vh=t=>{const e=ri(Ir());for(const n of t)en(e,n);return si(e)},Kh=(...t)=>{const e=ri(Ir());for(const n of t)en(e,n);return si(e)},Jh=u(2,(t,e)=>Ah(t._keyMap,e)),Hh=t=>us(t._keyMap),ri=t=>wr(Vc(t._keyMap)),si=t=>(t._keyMap._editable=!1,t),Jc=u(2,(t,e)=>{const n=ri(t);return e(n),si(n)}),en=u(2,(t,e)=>t._keyMap._editable?(tn(e,!0)(t._keyMap),t):wr(tn(e,!0)(t._keyMap))),Hc=u(2,(t,e)=>t._keyMap._editable?(to(e)(t._keyMap),t):wr(to(e)(t._keyMap))),Gh=u(2,(t,e)=>Jc(t,n=>{for(const r of e)Hc(n,r)})),Wh=u(2,(t,e)=>Jc(Ir(),n=>{Yh(t,r=>en(n,r));for(const r of e)en(n,r)})),Yh=u(2,(t,e)=>Dh(t._keyMap,(n,r)=>e(r))),zh=u(3,(t,e,n)=>vr(t._keyMap,e,(r,s,i)=>n(r,i))),zt=Ir,Qh=Vh,ii=Kh,Xh=Jh,Gc=Hh,Qe=en,Wc=Hc,eo=Gh,nn=Wh,Xn=zh,no=Symbol.for("effect/MutableRef"),Zh={[no]:no,toString(){return V(this.toJSON())},toJSON(){return{_id:"MutableRef",current:q(this.current)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},Yc=t=>{const e=Object.create(Zh);return e.current=t,e},Or=t=>t.current,zc=u(2,(t,e)=>(t.current=e,t)),oi="effect/FiberId",rn=Symbol.for(oi),Zn="None",fs="Runtime",td="Composite",ed=x(`${oi}-${Zn}`);let nd=class{[rn]=rn;_tag=Zn;id=-1;startTimeMillis=-1;[w](){return ed}[k](e){return Qc(e)&&e._tag===Zn}toString(){return V(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[A](){return this.toJSON()}};class rd{id;startTimeMillis;[rn]=rn;_tag=fs;constructor(e,n){this.id=e,this.startTimeMillis=n}[w](){return N(this,x(`${oi}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[k](e){return Qc(e)&&e._tag===fs&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return V(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[A](){return this.toJSON()}}const sd=new nd,Qc=t=>O(t,rn),hs=t=>{switch(t._tag){case Zn:return zt();case fs:return ii(t.id);case td:return f(hs(t.left),nn(hs(t.right)))}},ro=R(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Yc(0)),Xc=t=>Array.from(hs(t)).map(n=>`#${n}`).join(","),id=()=>{const t=Or(ro);return f(ro,zc(t+1)),new rd(t,Date.now())},Se=sd,od=Xc,Zc=id,ci=kr,cd=Th,ad=Ch,ta=Nh,ea=tn,na=Bc,ud=ni,ld=Lh,ra=vr,sn=Symbol.for("effect/List"),ds=t=>B(t),fd=t=>sl(Gs(t),ds),hd=fd(v),dd={[sn]:sn,_tag:"Cons",toString(){return V(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:ds(this).map(q)}},[A](){return this.toJSON()},[k](t){return ia(t)&&this._tag===t._tag&&hd(this,t)},[w](){return N(this,un(ds(this)))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return y(this,arguments)}},tr=(t,e)=>{const n=Object.create(dd);return n.head=t,n.tail=e,n},pd=x("Nil"),gd={[sn]:sn,_tag:"Nil",toString(){return V(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[A](){return this.toJSON()},[w](){return pd},[k](t){return ia(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return y(this,arguments)}},sa=Object.create(gd),ia=t=>O(t,sn),Rt=t=>t._tag==="Nil",md=t=>t._tag==="Cons",_d=()=>sa,Qt=(t,e)=>tr(t,e),ke=_d,ai=t=>tr(t,sa),yd=u(2,(t,e)=>Sd(e,t)),bd=u(2,(t,e)=>Qt(e,t)),Sd=u(2,(t,e)=>{if(Rt(t))return e;if(Rt(e))return t;{const n=tr(e.head,t);let r=n,s=e.tail;for(;!Rt(s);){const i=tr(s.head,t);r.tail=i,r=i,s=s.tail}return n}}),kd=u(3,(t,e,n)=>{let r=e,s=t;for(;!Rt(s);)r=n(r,s.head),s=s.tail;return r}),vd=t=>{let e=ke(),n=t;for(;!Rt(n);)e=bd(e,n.head),n=n.tail;return e},ui=function(){function t(e){e&&Object.assign(this,e)}return t.prototype=Vs,t}(),wd=Symbol.for("effect/DifferContextPatch");function so(t){return t}const dn={...ui.prototype,[wd]:{_Value:so,_Patch:so}},Id=Object.assign(Object.create(dn),{_tag:"Empty"}),Od=Object.create(Id),oa=()=>Od,Ed=Object.assign(Object.create(dn),{_tag:"AndThen"}),$d=(t,e)=>{const n=Object.create(Ed);return n.first=t,n.second=e,n},Md=Object.assign(Object.create(dn),{_tag:"AddService"}),Rd=(t,e)=>{const n=Object.create(Md);return n.key=t,n.service=e,n},Td=Object.assign(Object.create(dn),{_tag:"RemoveService"}),Fd=t=>{const e=Object.create(Td);return e.key=t,e},Cd=Object.assign(Object.create(dn),{_tag:"UpdateService"}),Nd=(t,e)=>{const n=Object.create(Cd);return n.key=t,n.update=e,n},Ad=(t,e)=>{const n=new Map(t.unsafeMap);let r=oa();for(const[s,i]of e.unsafeMap.entries())if(n.has(s)){const o=n.get(s);n.delete(s),v(o,i)||(r=jn(Nd(s,()=>i))(r))}else n.delete(s),r=jn(Rd(s,i))(r);for(const[s]of n.entries())r=jn(Fd(s))(r);return r},jn=u(2,(t,e)=>$d(t,e)),Pd=u(2,(t,e)=>{if(t._tag==="Empty")return e;let n=!1,r=et(t);const s=new Map(e.unsafeMap);for(;me(r);){const o=_e(r),c=Ut(r);switch(o._tag){case"Empty":{r=c;break}case"AddService":{s.set(o.key,o.service),r=c;break}case"AndThen":{r=pt(pt(c,o.second),o.first);break}case"RemoveService":{s.delete(o.key),r=c;break}case"UpdateService":{s.set(o.key,o.update(s.get(o.key))),n=!0,r=c;break}}}if(!n)return pe(s);const i=new Map;for(const[o]of e.unsafeMap)s.has(o)&&(i.set(o,s.get(o)),s.delete(o));for(const[o,c]of s)i.set(o,c);return pe(i)}),xd=Symbol.for("effect/DifferHashSetPatch");function Jr(t){return t}const Er={...ui.prototype,[xd]:{_Value:Jr,_Key:Jr,_Patch:Jr}},jd=Object.assign(Object.create(Er),{_tag:"Empty"}),Ld=Object.create(jd),ca=()=>Ld,Dd=Object.assign(Object.create(Er),{_tag:"AndThen"}),qd=(t,e)=>{const n=Object.create(Dd);return n.first=t,n.second=e,n},Ud=Object.assign(Object.create(Er),{_tag:"Add"}),Bd=t=>{const e=Object.create(Ud);return e.value=t,e},Vd=Object.assign(Object.create(Er),{_tag:"Remove"}),Kd=t=>{const e=Object.create(Vd);return e.value=t,e},Jd=(t,e)=>{const[n,r]=Xn([t,ca()],([s,i],o)=>Xh(o)(s)?[Wc(o)(s),i]:[s,ps(Bd(o))(i)])(e);return Xn(r,(s,i)=>ps(Kd(i))(s))(n)},ps=u(2,(t,e)=>qd(t,e)),Hd=u(2,(t,e)=>{if(t._tag==="Empty")return e;let n=e,r=et(t);for(;me(r);){const s=_e(r),i=Ut(r);switch(s._tag){case"Empty":{r=i;break}case"AndThen":{r=pt(s.first)(pt(s.second)(i));break}case"Add":{n=Qe(s.value)(n),r=i;break}case"Remove":n=Wc(s.value)(n),r=i}}return n}),Gd=Symbol.for("effect/DifferReadonlyArrayPatch");function io(t){return t}const pn={...ui.prototype,[Gd]:{_Value:io,_Patch:io}},Wd=Object.assign(Object.create(pn),{_tag:"Empty"}),Yd=Object.create(Wd),aa=()=>Yd,zd=Object.assign(Object.create(pn),{_tag:"AndThen"}),Qd=(t,e)=>{const n=Object.create(zd);return n.first=t,n.second=e,n},Xd=Object.assign(Object.create(pn),{_tag:"Append"}),Zd=t=>{const e=Object.create(Xd);return e.values=t,e},tp=Object.assign(Object.create(pn),{_tag:"Slice"}),ep=(t,e)=>{const n=Object.create(tp);return n.from=t,n.until=e,n},np=Object.assign(Object.create(pn),{_tag:"Update"}),rp=(t,e)=>{const n=Object.create(np);return n.index=t,n.patch=e,n},sp=t=>{let e=0,n=aa();for(;e<t.oldValue.length&&e<t.newValue.length;){const r=t.oldValue[e],s=t.newValue[e],i=t.differ.diff(r,s);v(i,t.differ.empty)||(n=Ln(n,rp(e,i))),e=e+1}return e<t.oldValue.length&&(n=Ln(n,ep(0,e))),e<t.newValue.length&&(n=Ln(n,Zd(hf(e)(t.newValue)))),n},Ln=u(2,(t,e)=>Qd(t,e)),ip=u(3,(t,e,n)=>{if(t._tag==="Empty")return e;let r=e.slice(),s=ft(t);for(;of(s);){const i=X(s),o=he(s);switch(i._tag){case"Empty":{s=o;break}case"AndThen":{o.unshift(i.first,i.second),s=o;break}case"Append":{for(const c of i.values)r.push(c);s=o;break}case"Slice":{r=r.slice(i.from,i.until),s=o;break}case"Update":{r[i.index]=n.patch(i.patch,r[i.index]),s=o;break}}}return r}),op=Symbol.for("effect/Differ"),cp={[op]:{_P:U,_V:U},pipe(){return y(this,arguments)}},Ce=t=>{const e=Object.create(cp);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},ap=()=>Ce({empty:oa(),combine:(t,e)=>jn(e)(t),diff:(t,e)=>Ad(t,e),patch:(t,e)=>Pd(e)(t)}),up=()=>Ce({empty:ca(),combine:(t,e)=>ps(e)(t),diff:(t,e)=>Jd(t,e),patch:(t,e)=>Hd(e)(t)}),lp=t=>Ce({empty:aa(),combine:(e,n)=>Ln(e,n),diff:(e,n)=>sp({oldValue:e,newValue:n,differ:t}),patch:(e,n)=>ip(e,n,t)}),ua=()=>fp((t,e)=>e),fp=t=>Ce({empty:U,combine:(e,n)=>e===U?n:n===U?e:r=>n(e(r)),diff:(e,n)=>v(e,n)?U:hr(n),patch:(e,n)=>t(n,e(n))}),on=255,la=8,gs=t=>t&on,ms=t=>t>>la&on,gn=(t,e)=>(t&on)+((e&t&on)<<la),hp=gn(0,0),dp=t=>gn(t,t),pp=t=>gn(t,0),gp=u(2,(t,e)=>gn(gs(t)&~e,ms(t))),mp=u(2,(t,e)=>t|e),_p=t=>~t>>>0&on,yp=0,Ne=1,bp=2,fa=4,_s=16,ha=32,Sp=t=>$r(t,ha),kp=u(2,(t,e)=>t|e),Nt=t=>da(t)&&!wp(t),da=t=>$r(t,Ne),$r=u(2,(t,e)=>(t&e)!==0),pa=(...t)=>t.reduce((e,n)=>e|n,0),vp=pa(yp),oo=t=>$r(t,fa),wp=t=>$r(t,_s),Dn=u(2,(t,e)=>gn(t^e,e)),qn=u(2,(t,e)=>t&(_p(gs(e))|ms(e))|gs(e)&ms(e)),co=Ce({empty:hp,diff:(t,e)=>Dn(t,e),combine:(t,e)=>mp(e)(t),patch:(t,e)=>qn(e,t)}),Ip=dp,ga=pp,ao=gp,ma=(t,e)=>({_tag:"Par",left:t,right:e}),Rn=(t,e)=>({_tag:"Seq",left:t,right:e}),Op=t=>{let e=ai(t),n=ke();for(;;){const[r,s]=kd(e,[_a(),ke()],([i,o],c)=>{const[a,l]=Ep(c);return[Fp(i,a),yd(o,l)]});if(n=$p(n,r),Rt(s))return vd(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Ep=t=>{let e=t,n=_a(),r=ke(),s=ke();for(;;)switch(e._tag){case"Empty":{if(Rt(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=Qt(e.right,r),e=e.left;break}case"Seq":{const i=e.left,o=e.right;switch(i._tag){case"Empty":{e=o;break}case"Par":{const c=i.left,a=i.right;e=ma(Rn(c,o),Rn(a,o));break}case"Seq":{const c=i.left,a=i.right;e=Rn(c,Rn(a,o));break}case"Single":{e=i,s=Qt(o,s);break}}break}case"Single":{if(n=Tp(n,e),Rt(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},$p=(t,e)=>{if(Rt(t))return ai(Hr(e));if(Cp(e))return t;const n=Lp(t.head),r=Np(e);return n.length===1&&r.length===1&&v(n[0],r[0])?Qt(jp(t.head,Hr(e)),t.tail):Qt(Hr(e),t)},Mp=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Rp={_R:t=>t};class li{map;[Mp]=Rp;constructor(e){this.map=e}}const _a=()=>new li(ci()),Tp=(t,e)=>new li(ud(t.map,e.dataSource,n=>Gl(Wl(n,zf(e.blockedRequest)),()=>et(e.blockedRequest)))),Fp=(t,e)=>new li(ra(t.map,e.map,(n,r,s)=>ea(n,s,Ks(ta(n,s),{onNone:()=>r,onSome:i=>ht(r,i)})))),Cp=t=>ad(t.map),Np=t=>Array.from(na(t.map)),Hr=t=>xp(ld(t.map,e=>et(e))),Ap=Symbol.for("effect/RequestBlock/RequestBlockSequential"),Pp={_R:t=>t};class ya{map;[Ap]=Pp;constructor(e){this.map=e}}const xp=t=>new ya(t),jp=(t,e)=>new ya(ra(e.map,t.map,(n,r,s)=>ea(n,s,Ks(ta(n,s),{onNone:()=>Ft(),onSome:i=>ht(i,r)})))),Lp=t=>Array.from(na(t.map)),Dp=t=>Array.from(t.map),mn="Die",Xt="Empty",Ae="Fail",Pe="Interrupt",ve="Parallel",we="Sequential",ba="effect/Cause",Sa=Symbol.for(ba),qp={_E:t=>t},xe={[Sa]:qp,[w](){return f(_(ba),E(_(Zp(this))),N(this))},[k](t){return Up(t)&&Xp(this,t)},pipe(){return y(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:q(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:q(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:q(this.left),right:q(this.right)}}},toString(){return _n(this)},[A](){return this.toJSON()}},Ie=(()=>{const t=Object.create(xe);return t._tag=Xt,t})(),er=t=>{const e=Object.create(xe);return e._tag=Ae,e.error=t,e},Tt=t=>{const e=Object.create(xe);return e._tag=mn,e.defect=t,e},At=t=>{const e=Object.create(xe);return e._tag=Pe,e.fiberId=t,e},Mr=(t,e)=>{const n=Object.create(xe);return n._tag=ve,n.left=t,n.right=e,n},ot=(t,e)=>{const n=Object.create(xe);return n._tag=we,n.left=t,n.right=e,n},Up=t=>O(t,Sa),Bp=t=>t._tag===Xt,Vp=t=>t._tag===Xt?!0:Oe(t,!0,(e,n)=>{switch(n._tag){case Xt:return M(e);case mn:case Ae:case Pe:return M(!1);default:return S()}}),Kp=t=>St(zp(t)),fi=t=>hi(void 0,eg)(t),Jp=t=>ge(Oe(t,Ft(),(e,n)=>n._tag===Ae?M(f(e,pt(n.error))):S())),Hp=t=>ge(Oe(t,Ft(),(e,n)=>n._tag===mn?M(f(e,pt(n.defect))):S())),Gp=t=>Oe(t,zt(),(e,n)=>n._tag===Pe?M(f(e,Qe(n.fiberId))):S()),Wp=t=>ka(t,e=>e._tag===Ae?M(e.error):S()),Yp=t=>{const e=Wp(t);switch(e._tag){case"None":return Mt(t);case"Some":return fe(e.value)}},zp=t=>ka(t,e=>e._tag===Pe?M(e.fiberId):S()),uo=t=>va(t,{onEmpty:Ie,onFail:()=>Ie,onDie:Tt,onInterrupt:At,onSequential:ot,onParallel:Mr}),Qp=t=>va(t,{onEmpty:Ie,onFail:Tt,onDie:Tt,onInterrupt:At,onSequential:ot,onParallel:Mr}),Xp=(t,e)=>{let n=et(t),r=et(e);for(;me(n)&&me(r);){const[s,i]=f(_e(n),Oe([zt(),Ft()],([a,l],d)=>{const[h,p]=ys(d);return M([f(a,nn(h)),f(l,ht(p))])})),[o,c]=f(_e(r),Oe([zt(),Ft()],([a,l],d)=>{const[h,p]=ys(d);return M([f(a,nn(h)),f(l,ht(p))])}));if(!v(s,o))return!1;n=i,r=c}return!0},Zp=t=>tg(et(t),Ft()),tg=(t,e)=>{for(;;){const[n,r]=f(t,Sc([zt(),Ft()],([i,o],c)=>{const[a,l]=ys(c);return[f(i,nn(a)),f(o,ht(l))]})),s=Gc(n)>0?f(e,pt(n)):e;if(Qf(r))return ge(s);t=r,e=s}throw new Error(gr("Cause.flattenCauseLoop"))},ka=u(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case we:case ve:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return S()}),ys=t=>{let e=t;const n=[];let r=zt(),s=Ft();for(;e!==void 0;)switch(e._tag){case Xt:{if(n.length===0)return[r,s];e=n.pop();break}case Ae:{if(r=Qe(r,Vr(e._tag,e.error)),n.length===0)return[r,s];e=n.pop();break}case mn:{if(r=Qe(r,Vr(e._tag,e.defect)),n.length===0)return[r,s];e=n.pop();break}case Pe:{if(r=Qe(r,Vr(e._tag,e.fiberId)),n.length===0)return[r,s];e=n.pop();break}case we:{switch(e.left._tag){case Xt:{e=e.right;break}case we:{e=ot(e.left.left,ot(e.left.right,e.right));break}case ve:{e=Mr(ot(e.left.left,e.right),ot(e.left.right,e.right));break}default:{s=pt(s,e.right),e=e.left;break}}break}case ve:{n.push(e.right),e=e.left;break}}throw new Error(gr("Cause.evaluateCauseLoop"))},eg={emptyCase:Ki,failCase:Xr,dieCase:Xr,interruptCase:Ki,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},lo="SequentialCase",fo="ParallelCase",va=u(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:i,onSequential:o})=>hi(t,void 0,{emptyCase:()=>n,failCase:(c,a)=>r(a),dieCase:(c,a)=>e(a),interruptCase:(c,a)=>s(a),sequentialCase:(c,a,l)=>o(a,l),parallelCase:(c,a,l)=>i(a,l)})),Oe=u(3,(t,e,n)=>{let r=e,s=t;const i=[];for(;s!==void 0;){const o=n(r,s);switch(r=St(o)?o.value:r,s._tag){case we:{i.push(s.right),s=s.left;break}case ve:{i.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&i.length>0&&(s=i.pop())}return r}),hi=u(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const o=r.pop();switch(o._tag){case Xt:{s.push(Mt(n.emptyCase(e)));break}case Ae:{s.push(Mt(n.failCase(e,o.error)));break}case mn:{s.push(Mt(n.dieCase(e,o.defect)));break}case Pe:{s.push(Mt(n.interruptCase(e,o.fiberId)));break}case we:{r.push(o.right),r.push(o.left),s.push(fe({_tag:lo}));break}case ve:{r.push(o.right),r.push(o.left),s.push(fe({_tag:fo}));break}}}const i=[];for(;s.length>0;){const o=s.pop();switch(o._tag){case"Left":{switch(o.left._tag){case lo:{const c=i.pop(),a=i.pop(),l=n.sequentialCase(e,c,a);i.push(l);break}case fo:{const c=i.pop(),a=i.pop(),l=n.parallelCase(e,c,a);i.push(l);break}}break}case"Right":{i.push(o.right);break}}}if(i.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return i.pop()}),_n=(t,e)=>fi(t)?"All fibers interrupted without errors.":Ia(t).map(function(n){return e?.renderErrorCause!==!0||n.cause===void 0?n.stack:`${n.stack} {
${wa(n.cause,"  ")}
}`}).join(`
`),wa=(t,e)=>{const n=t.stack.split(`
`);let r=`${e}[cause]: ${n[0]}`;for(let s=1,i=n.length;s<i;s++)r+=`
${e}${n[s]}`;return t.cause&&(r+=` {
${wa(t.cause,`${e}  `)}
${e}}`),r};class nr extends globalThis.Error{span=void 0;constructor(e){const n=typeof e=="object"&&e!==null,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(ng(e),n&&"cause"in e&&typeof e.cause<"u"?{cause:new nr(e.cause)}:void 0),this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=e instanceof Error?e.name:"Error",n&&(Ee in e&&(this.span=e[Ee]),Object.keys(e).forEach(s=>{s in this||(this[s]=e[s])})),this.stack=ig(`${this.name}: ${this.message}`,e instanceof Error&&e.stack?e.stack:"",this.span)}}const ng=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null&&t instanceof Error)return t.message;try{if(O(t,"toString")&&dr(t.toString)&&t.toString!==Object.prototype.toString&&t.toString!==globalThis.Array.prototype.toString)return t.toString()}catch{}return Zo(t)},rg=/\((.*)\)/g,sg=R("effect/Tracer/spanToTrace",()=>new WeakMap),ig=(t,e,n)=>{const r=[t],s=e.startsWith(t)?e.slice(t.length).split(`
`):e.split(`
`);for(let i=1;i<s.length;i++){if(s[i].includes(" at new BaseEffectError")||s[i].includes(" at new YieldableError")){i++;continue}if(s[i].includes("Generator.next")||s[i].includes("effect_internal_function"))break;r.push(s[i].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let i=n,o=0;for(;i&&i._tag==="Span"&&o<10;){const c=sg.get(i);if(typeof c=="function"){const a=c();if(typeof a=="string"){const l=a.matchAll(rg);let d=!1;for(const[,h]of l)d=!0,r.push(`    at ${i.name} (${h})`);d||r.push(`    at ${i.name} (${a.replace(/^at /,"")})`)}else r.push(`    at ${i.name}`)}else r.push(`    at ${i.name}`);i=Dt(i.parent),o++}}return r.join(`
`)},Ee=Symbol.for("effect/SpanAnnotation"),Ia=t=>hi(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[new nr(n)],failCase:(e,n)=>[new nr(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),Rr="Pending",Oa="Done",og="effect/Deferred",cg=Symbol.for(og),ag={_E:t=>t,_A:t=>t},ug=t=>({_tag:Rr,joiners:t}),lg=t=>({_tag:Oa,effect:t});class yn{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new yn(this.self)}}const Ea=(t,e)=>{const n=new W("Blocked");return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n},fg=t=>{const e=new W("RunBlocked");return e.effect_instruction_i0=t,e},$e=Symbol.for("effect/Effect");class hg{patch;op;_op=Us;constructor(e,n){this.patch=e,this.op=n}}class W{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[$e]=le;constructor(e){this._op=e}[k](e){return this===e}[w](){return N(this,js(this))}pipe(){return y(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:q(this.effect_instruction_i0),effect_instruction_i1:q(this.effect_instruction_i1),effect_instruction_i2:q(this.effect_instruction_i2)}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new yn(new an(this))}}class $a{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[$e]=le;constructor(e){this._op=e,this._tag=e}[k](e){return Cr(e)&&e._op==="Failure"&&v(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return f(x(this._tag),E(_(this.effect_instruction_i0)),N(this))}get cause(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new yn(new an(this))}}class Ma{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[$e]=le;constructor(e){this._op=e,this._tag=e}[k](e){return Cr(e)&&e._op==="Success"&&v(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return f(x(this._tag),E(_(this.effect_instruction_i0)),N(this))}get value(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:q(this.value)}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new yn(new an(this))}}const di=t=>O(t,$e),gt=t=>{const e=new W(nc);return e.effect_instruction_i0=t,e},dg=u(3,(t,e,n)=>Tr(r=>I(t,s=>I(Fa(G(()=>r(e(s)))),i=>G(()=>n(s,i)).pipe(Me({onFailure:o=>{switch(i._tag){case at:return mt(ot(i.effect_instruction_i0,o));case ut:return mt(o)}},onSuccess:()=>i})))))),bn=u(2,(t,e)=>I(t,()=>C(e))),Sn=t=>bn(t,void 0),Ra=function(){const t=new W(_r);switch(arguments.length){case 2:{t.effect_instruction_i0=arguments[0],t.commit=arguments[1];break}case 3:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.commit=arguments[2];break}case 4:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.effect_instruction_i2=arguments[2],t.commit=arguments[3];break}default:throw new Error(gr("you're not supposed to end up here"))}return t},rr=(t,e=Se)=>{const n=new W(Ye);let r;return n.effect_instruction_i0=s=>{r=t(s)},n.effect_instruction_i1=e,xa(n,s=>di(r)?r:kt)},pg=(t,e=Se)=>G(()=>rr(t,e)),Zt=(t,e=Se)=>Ra(t,function(){let n,r;function s(a){n?n(a):r===void 0&&(r=a)}const i=new W(Ye);i.effect_instruction_i0=a=>{n=a,r&&a(r)},i.effect_instruction_i1=e;let o,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,o=z(()=>this.effect_instruction_i0(s,c.signal))):o=z(()=>this.effect_instruction_i0(s)),o||c?xa(i,a=>(c&&c.abort(),o??kt)):i}),ho=u(2,(t,e)=>gi(t,{onFailure:e,onSuccess:C})),po=Symbol.for("effect/OriginalAnnotation"),Ta=(t,e)=>St(e)?new Proxy(t,{has(n,r){return r===Ee||r===po||r in n},get(n,r){return r===Ee?e.value:r===po?t:n[r]}}):t,go=t=>pr(t)&&!(Ee in t)?gt(e=>mt(Tt(Ta(t,Za(e))))):mt(Tt(t)),gg=t=>mg(()=>Tt(new Jg(t))),bs=t=>gi(t,{onFailure:e=>C(fe(e)),onSuccess:e=>C(Mt(e))}),Fa=t=>yg(t,{onFailure:T,onSuccess:L}),Y=t=>pr(t)&&!(Ee in t)?gt(e=>mt(er(Ta(t,Za(e))))):mt(er(t)),pi=t=>I(b(t),Y),mt=t=>{const e=new $a(at);return e.effect_instruction_i0=t,e},mg=t=>I(b(t),mt),_g=gt(t=>C(t.id())),Ca=t=>gt(e=>t(e.id())),I=u(2,(t,e)=>{const n=new W(Jn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n}),Na=t=>I(t,U),yg=u(2,(t,e)=>Me(t,{onFailure:n=>C(e.onFailure(n)),onSuccess:n=>C(e.onSuccess(n))})),Me=u(2,(t,e)=>{const n=new W(Hn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e.onFailure,n.effect_instruction_i2=e.onSuccess,n}),gi=u(2,(t,e)=>Me(t,{onFailure:n=>{if(Hp(n).length>0)return mt(Qp(n));const s=Jp(n);return s.length>0?e.onFailure(Cc(s)):mt(n)},onSuccess:e.onSuccess})),Bt=u(2,(t,e)=>G(()=>{const n=B(t),r=Hs(n.length);let s=0;return bn(bi({while:()=>s<n.length,body:()=>e(n[s],s),step:i=>{r[s++]=i}}),r)})),mi=u(2,(t,e)=>G(()=>{const n=B(t);let r=0;return bi({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),Aa=t=>{const e=new W(ln);return e.effect_instruction_i0=Ip(Ne),e.effect_instruction_i1=()=>t,e},ct=u(2,(t,e)=>I(t,n=>b(()=>e(n)))),Pa=u(2,(t,e)=>gi(t,{onFailure:n=>pi(()=>e.onFailure(n)),onSuccess:n=>b(()=>e.onSuccess(n))})),_i=u(2,(t,e)=>Me(t,{onFailure:n=>{const r=Yp(n);switch(r._tag){case"Left":return pi(()=>e(r.left));case"Right":return mt(r.right)}},onSuccess:C})),yi=u(2,(t,e)=>Tr(n=>Me(n(t),{onFailure:r=>{const s=T(r);return Me(e(s),{onFailure:i=>T(ot(r,i)),onSuccess:()=>s})},onSuccess:r=>{const s=L(r);return qa(e(s),s)}}))),xa=u(2,(t,e)=>yi(t,za({onFailure:n=>fi(n)?Sn(e(Gp(n))):kt,onSuccess:()=>kt}))),C=t=>{const e=new Ma(ut);return e.effect_instruction_i0=t,e},G=t=>{const e=new W(_r);return e.commit=t,e},b=t=>{const e=new W(ec);return e.effect_instruction_i0=t,e},bg=u(t=>t.length===3||t.length===2&&!(pr(t[1])&&"onlyEffect"in t[1]),(t,e)=>I(t,n=>{const r=typeof e=="function"?e(n):e;return di(r)?bn(r,n):ul(r)?rr(s=>{r.then(i=>s(C(n)),i=>s(Y(new Ya(i,"An unknown error occurred in Effect.tap"))))}):C(n)})),Sg=t=>gt(e=>{const n=e.getFiberRef(ks),r=f(n,Wt(()=>e.scope()));return t(vi(ks,M(r)))}),ja=t=>{const e=new W(ln);return e.effect_instruction_i0=ga(Ne),e.effect_instruction_i1=()=>t,e},Tr=t=>Ra(t,function(){const e=new W(ln);return e.effect_instruction_i0=ga(Ne),e.effect_instruction_i1=n=>da(n)?z(()=>this.effect_instruction_i0(Aa)):z(()=>this.effect_instruction_i0(ja)),e}),kt=C(void 0),kg=t=>{const e=new W(ln);return e.effect_instruction_i0=t,e.effect_instruction_i1=void 0,e},bi=t=>{const e=new W(Gn);return e.effect_instruction_i0=t.while,e.effect_instruction_i1=t.body,e.effect_instruction_i2=t.step,e},Si=t=>{const e=new W(Pn);return typeof t?.priority<"u"?Dg(e,t.priority):e},La=u(2,(t,e)=>I(t,n=>ct(e,r=>[n,r]))),Da=u(2,(t,e)=>I(t,n=>bn(e,n))),qa=u(2,(t,e)=>I(t,()=>e)),vg=t=>I(_g,e=>f(t,Ua(e))),Ua=u(2,(t,e)=>I(t.interruptAsFork(e),()=>t.await)),wg={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return y(this,arguments)}},Ig={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return y(this,arguments)}},Og={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return y(this,arguments)}},Ba={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return y(this,arguments)}},Va={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return y(this,arguments)}},Ka={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return y(this,arguments)}},Eg={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return y(this,arguments)}},$g={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return y(this,arguments)}},Mg="effect/FiberRef",Rg=Symbol.for(Mg),Tg={_A:t=>t},ki=t=>gt(e=>L(e.getFiberRef(t))),Ja=u(2,(t,e)=>I(ki(t),e)),mo=u(2,(t,e)=>Fg(t,()=>[void 0,e])),Fg=u(2,(t,e)=>gt(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),C(r)})),vi=u(3,(t,e,n)=>dg(Da(ki(e),mo(e,n)),()=>t,r=>mo(e,r))),lt=(t,e)=>je(t,{differ:ua(),fork:e?.fork??U,join:e?.join}),Cg=t=>{const e=up();return je(t,{differ:e,fork:e.empty})},Ng=t=>{const e=lp(ua());return je(t,{differ:e,fork:e.empty})},Ha=t=>{const e=ap();return je(t,{differ:e,fork:e.empty})},je=(t,e)=>({...hn,[Rg]:Tg,initial:t,commit(){return ki(this)},diff:(r,s)=>e.differ.diff(r,s),combine:(r,s)=>e.differ.combine(r,s),patch:r=>s=>e.differ.patch(r,s),fork:e.fork,join:e.join??((r,s)=>s)}),Ag=t=>je(t,{differ:co,fork:co.empty}),Fr=R(Symbol.for("effect/FiberRef/currentContext"),()=>Ha(Ys())),wi=R(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>lt(0)),Pg=R(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>lt(2048)),xg=R(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>lt(ci())),jg=R(Symbol.for("effect/FiberRef/currentLogLevel"),()=>lt(Va)),Lg=R(Symbol.for("effect/FiberRef/currentLogSpan"),()=>lt(ke())),Dg=u(2,(t,e)=>vi(t,wi,e)),qg=R(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>lt(M(Ka))),Ug=R(Symbol.for("effect/FiberRef/versionMismatchErrorLogLevel"),()=>lt(M(Ba))),Ss=R(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>Ng(de())),ks=R(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>lt(S(),{fork:()=>S(),join:(t,e)=>t})),Tn=R(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>lt(Ie,{fork:()=>Ie,join:(t,e)=>t})),Bg=(t,e)=>t.addFinalizer(()=>Sn(e)),Vg=(t,e)=>t.close(e),Kg=(t,e)=>t.fork(e),Ii=function(){class t extends globalThis.Error{commit(){return Y(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[A](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?_n(er(this),{renderErrorCause:!0}):this}}return Object.assign(t.prototype,Nl),t}(),Ga=(t,e)=>{class n extends Ii{_tag=e}return Object.assign(n.prototype,t),n.prototype.name=e,n},_o=Symbol.for("effect/Cause/errors/RuntimeException"),Jg=Ga({[_o]:_o},"RuntimeException"),Hg=Symbol.for("effect/Cause/errors/InterruptedException"),Gg=t=>O(t,Hg),yo=Symbol.for("effect/Cause/errors/NoSuchElement"),Wa=Ga({[yo]:yo},"NoSuchElementException"),bo=Symbol.for("effect/Cause/errors/UnknownException"),Ya=function(){class t extends Ii{_tag="UnknownException";error;constructor(n,r){super(r??"An unknown error occurred",{cause:n}),this.error=n}}return Object.assign(t.prototype,{[bo]:bo,name:"UnknownException"}),t}(),Cr=t=>di(t)&&"_tag"in t&&(t._tag==="Success"||t._tag==="Failure"),So=(t,e)=>zg(t,e?.parallel?Mr:ot),ko=t=>T(er(t)),T=t=>{const e=new $a(at);return e.effect_instruction_i0=t,e},Wg=t=>T(At(t)),Gr=u(2,(t,e)=>{switch(t._tag){case at:return T(t.effect_instruction_i0);case ut:return L(e(t.effect_instruction_i0))}}),za=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case at:return e(t.effect_instruction_i0);case ut:return n(t.effect_instruction_i0)}}),L=t=>{const e=new Ma(ut);return e.effect_instruction_i0=t,e},Vt=L(void 0),Yg=u(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case at:switch(e._tag){case ut:return T(t.effect_instruction_i0);case at:return T(n(t.effect_instruction_i0,e.effect_instruction_i0))}case ut:switch(e._tag){case ut:return L(r(t.effect_instruction_i0,e.effect_instruction_i0));case at:return T(e.effect_instruction_i0)}}}),zg=(t,e)=>{const n=Fc(t);return me(n)?f(Ut(n),Sc(f(_e(n),Gr(et)),(r,s)=>f(r,Yg(s,{onSuccess:(i,o)=>f(i,pt(o)),onFailure:e}))),Gr(ge),Gr(r=>Ht(r)),M):S()},Qg=t=>({...hn,[cg]:ag,state:Yc(ug([])),commit(){return Qa(this)},blockingOn:t}),Qa=t=>pg(e=>{const n=Or(t.state);switch(n._tag){case Oa:return e(n.effect);case Rr:return n.joiners.push(e),Xg(t,e)}},t.blockingOn),Xa=(t,e)=>{const n=Or(t.state);if(n._tag===Rr){zc(t.state,lg(e));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](e)}},Xg=(t,e)=>b(()=>{const n=Or(t.state);if(n._tag===Rr){const r=n.joiners.indexOf(e);r>=0&&n.joiners.splice(r,1)}}),Za=t=>{const e=t.currentSpan;return e!==void 0&&e._tag==="Span"?M(e):S()},vo=Symbol.for("effect/MutableHashMap"),Zg={[vo]:vo,[Symbol.iterator](){return new Oi(this)},toString(){return V(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}};class Oi{self;referentialIterator;bucketIterator;constructor(e){this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const e=this.referentialIterator.next();return e.done?(this.bucketIterator=new tm(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new Oi(this.self)}}class tm{backing;constructor(e){this.backing=e}currentBucket;next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}const em=()=>{const t=Object.create(Zg);return t.referential=new Map,t.buckets=new Map,t.bucketsSize=0,t},qt=u(2,(t,e)=>{if(Kn(e)===!1)return t.referential.has(e)?M(t.referential.get(e)):S();const n=e[w](),r=t.buckets.get(n);return r===void 0?S():nm(t,r,e)}),nm=(t,e,n,r=!1)=>{for(let s=0,i=e.length;s<i;s++)if(n[k](e[s][0])){const o=e[s][1];return r&&(e.splice(s,1),t.bucketsSize--),M(o)}return S()},Ke=u(2,(t,e)=>St(qt(t,e))),Je=u(3,(t,e,n)=>{if(Kn(e)===!1)return t.referential.set(e,n),t;const r=e[w](),s=t.buckets.get(r);return s===void 0?(t.buckets.set(r,[[e,n]]),t.bucketsSize++,t):(rm(t,s,e),s.push([e,n]),t.bucketsSize++,t)}),rm=(t,e,n)=>{for(let r=0,s=e.length;r<s;r++)if(n[k](e[r][0])){e.splice(r,1),t.bucketsSize--;return}},sm="effect/Clock",wo=Symbol.for(sm),Ei=Fe("effect/Clock"),im=2**31-1,Io={unsafeSchedule(t,e){const n=cs(e);if(n>im)return Xr;let r=!1;const s=setTimeout(()=>{r=!0,t()},n);return()=>(clearTimeout(s),!r)}},Oo=function(){const t=BigInt(1e6);if(typeof performance>"u"||typeof performance.now!="function")return()=>BigInt(Date.now())*t;let e;return()=>(e===void 0&&(e=BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6))),e+BigInt(Math.round(performance.now()*1e6)))}(),om=function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return Oo;const e=Oo()-t.bigint();return()=>e+t.bigint()}();class cm{[wo]=wo;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return om()}currentTimeMillis=b(()=>this.unsafeCurrentTimeMillis());currentTimeNanos=b(()=>this.unsafeCurrentTimeNanos());scheduler(){return C(Io)}sleep(e){return Zt(n=>{const r=Io.unsafeSchedule(()=>n(kt),e);return Sn(b(r))})}}const am=()=>new cm,tu="And",eu="Or",nu="InvalidData",ru="MissingData",su="SourceUnavailable",iu="Unsupported",um="effect/ConfigError",Eo=Symbol.for(um),Le={_tag:"ConfigError",[Eo]:Eo},ou=(t,e)=>{const n=Object.create(Le);return n._op=tu,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},cu=(t,e)=>{const n=Object.create(Le);return n._op=eu,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},lm=(t,e,n={pathDelim:"."})=>{const r=Object.create(Le);return r._op=nu,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${f(this.path,Te(n.pathDelim))}: "${this.message}")`}}),r},te=(t,e,n={pathDelim:"."})=>{const r=Object.create(Le);return r._op=ru,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${f(this.path,Te(n.pathDelim))}: "${this.message}")`}}),r},fm=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(Le);return s._op=su,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${f(this.path,Te(r.pathDelim))}: "${this.message}")`}}),s},hm=(t,e,n={pathDelim:"."})=>{const r=Object.create(Le);return r._op=iu,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${f(this.path,Te(n.pathDelim))}: "${this.message}")`}}),r},Kt=u(2,(t,e)=>{switch(t._op){case tu:return ou(Kt(t.left,e),Kt(t.right,e));case eu:return cu(Kt(t.left,e),Kt(t.right,e));case nu:return lm([...e,...t.path],t.message);case ru:return te([...e,...t.path],t.message);case su:return fm([...e,...t.path],t.message,t.cause);case iu:return hm([...e,...t.path],t.message)}}),dm={_tag:"Empty"},Wr=u(2,(t,e)=>{let n=ai(e),r=t;for(;md(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Qt(s.first,Qt(s.second,n.tail));break}case"MapName":{r=ie(r,s.f),n=n.tail;break}case"Nested":{r=Wn(r,s.name),n=n.tail;break}case"Unnested":{if(f(ze(r),Xl(s.name)))r=he(r),n=n.tail;else return fe(te(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return Mt(r)}),pm="Constant",gm="Fail",mm="Fallback",_m="Described",ym="Lazy",bm="MapOrFail",Sm="Nested",km="Primitive",vm="Sequence",wm="HashMap",Im="ZipWith";var $o={};const sr=(t,e)=>[...t,...e],Om="effect/ConfigProvider",Mo=Symbol.for(Om),Em=Fe("effect/ConfigProvider"),$m="effect/ConfigProviderFlat",Ro=Symbol.for($m),Mm=t=>({[Mo]:Mo,pipe(){return y(this,arguments)},...t}),Rm=t=>({[Ro]:Ro,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),Tm=t=>Mm({load:e=>I(it(t,de(),e,!1),n=>Ks(ze(n),{onNone:()=>Y(te(de(),`Expected a single value having structure: ${e}`)),onSome:C})),flattened:t}),Fm=t=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=a=>f(a,Te(e)),s=a=>a.split(e),i=()=>typeof process<"u"&&"env"in process&&typeof $o=="object"?$o:{};return Tm(Rm({load:(a,l,d=!0)=>{const h=r(a),p=i(),g=h in p?M(p[h]):S();return f(g,_i(()=>te(a,`Expected ${h} to exist in the process context`)),I(m=>xm(m,a,l,n,d)))},enumerateChildren:a=>b(()=>{const l=i(),p=Object.keys(l).map(g=>s(g.toUpperCase())).filter(g=>{for(let m=0;m<a.length;m++){const $=f(a,yc(m)),F=g[m];if(F===void 0||$!==F)return!1}return!0}).flatMap(g=>g.slice(a.length,a.length+1));return Qh(p)}),patch:dm}))},Cm=(t,e,n,r)=>{const s=Yi(n.length,a=>a>=r.length?S():M([t(a),a+1])),i=Yi(r.length,a=>a>=n.length?S():M([e(a),a+1])),o=sr(n,s),c=sr(r,i);return[o,c]},Nm=(t,e)=>{let n=e;if(n._tag==="Nested"){const r=t.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return t},it=(t,e,n,r)=>{const s=n;switch(s._tag){case pm:return C(ft(s.value));case _m:return G(()=>it(t,e,s.config,r));case gm:return Y(te(e,s.message));case mm:return f(G(()=>it(t,e,s.first,r)),ho(i=>s.condition(i)?f(it(t,e,s.second,r),ho(o=>Y(cu(i,o)))):Y(i)));case ym:return G(()=>it(t,e,s.config(),r));case bm:return G(()=>f(it(t,e,s.original,r),I(Bt(i=>f(s.mapOrFail(i),_i(Kt(Nm(e,s.original))))))));case Sm:return G(()=>it(t,sr(e,ft(s.name)),s.config,r));case km:return f(Wr(e,t.patch),I(i=>f(t.load(i,s,r),I(o=>{if(o.length===0){const c=f(uf(i),Wt(()=>"<n/a>"));return Y(te([],`Expected ${s.description} with name ${c}`))}return C(o)}))));case vm:return f(Wr(e,t.patch),I(i=>f(t.enumerateChildren(i),I(Lm),I(o=>o.length===0?G(()=>ct(it(t,e,s.config,!0),ft)):f(Bt(o,c=>it(t,nf(e,`[${c}]`),s.config,!0)),ct(c=>{const a=Sf(c);return a.length===0?ft(de()):ft(a)}))))));case wm:return G(()=>f(Wr(e,t.patch),I(i=>f(t.enumerateChildren(i),I(o=>f(o,Bt(c=>it(t,sr(i,ft(c)),s.valueConfig,r)),ct(c=>c.length===0?ft(ci()):f(jm(c),ie(a=>cd(Wi(B(o),a)))))))))));case Im:return G(()=>f(it(t,e,s.left,r),bs,I(i=>f(it(t,e,s.right,r),bs,I(o=>{if(We(i)&&We(o))return Y(ou(i.left,o.left));if(We(i)&&$n(o))return Y(i.left);if($n(i)&&We(o))return Y(o.left);if($n(i)&&$n(o)){const c=f(e,Te(".")),a=Am(e,c),[l,d]=Cm(a,a,f(i.right,ie(Mt)),f(o.right,ie(Mt)));return f(l,Wi(d),Bt(([h,p])=>f(La(h,p),ct(([g,m])=>s.zip(g,m)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},Am=(t,e)=>n=>fe(te(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),Pm=(t,e)=>t.split(new RegExp(`\\s*${vf(e)}\\s*`)),xm=(t,e,n,r,s)=>s?f(Pm(t,r),Bt(i=>n.parse(i.trim())),_i(Kt(e))):f(n.parse(t),Pa({onFailure:Kt(e),onSuccess:ft})),jm=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),Lm=t=>f(Bt(t,qm),Pa({onFailure:()=>de(),onSuccess:Yn(Ze)}),bs,ct(Vl)),Dm=/^(\[(\d+)\])$/,qm=t=>{const e=t.match(Dm);if(e!==null){const n=e[2];return f(n!==void 0&&n.length>0?M(n):S(),Yl(Um))}return S()},Um=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?S():M(e)},To=Symbol.for("effect/Console"),au=Fe("effect/Console"),Bm={[To]:To,assert(t,...e){return b(()=>{console.assert(t,...e)})},clear:b(()=>{console.clear()}),count(t){return b(()=>{console.count(t)})},countReset(t){return b(()=>{console.countReset(t)})},debug(...t){return b(()=>{console.debug(...t)})},dir(t,e){return b(()=>{console.dir(t,e)})},dirxml(...t){return b(()=>{console.dirxml(...t)})},error(...t){return b(()=>{console.error(...t)})},group(t){return t?.collapsed?b(()=>console.groupCollapsed(t?.label)):b(()=>console.group(t?.label))},groupEnd:b(()=>{console.groupEnd()}),info(...t){return b(()=>{console.info(...t)})},log(...t){return b(()=>{console.log(...t)})},table(t,e){return b(()=>{console.table(t,e)})},time(t){return b(()=>console.time(t))},timeEnd(t){return b(()=>console.timeEnd(t))},timeLog(t,...e){return b(()=>{console.timeLog(t,...e)})},trace(...t){return b(()=>{console.trace(...t)})},warn(...t){return b(()=>{console.warn(...t)})},unsafe:console},Vm="effect/Random",Fo=Symbol.for(Vm),Km=Fe("effect/Random");class Jm{seed;[Fo]=Fo;PRNG;constructor(e){this.seed=e,this.PRNG=new ml(e)}get next(){return b(()=>this.PRNG.number())}get nextBoolean(){return ct(this.next,e=>e>.5)}get nextInt(){return b(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return ct(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return b(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return Hm(e,n=>this.nextIntBetween(0,n))}}const Hm=(t,e)=>G(()=>f(b(()=>Array.from(t)),I(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return f(r,mi(s=>f(e(s),ct(i=>Gm(n,s-1,i)))),bn(Fc(n)))}))),Gm=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},Wm=t=>new Jm(_(t)),Co=Symbol.for("effect/Tracer"),Ym=t=>({[Co]:Co,...t}),uu=Fe("effect/Tracer"),lu=Fe("effect/ParentSpan"),No=function(){const t="abcdef0123456789",e=t.length;return function(n){let r="";for(let s=0;s<n;s++)r+=t.charAt(Math.floor(Math.random()*e));return r}}();class zm{name;parent;context;startTime;kind;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];links;constructor(e,n,r,s,i,o){this.name=e,this.parent=n,this.context=r,this.startTime=i,this.kind=o,this.status={_tag:"Started",startTime:i},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:No(32),this.spanId=No(16),this.links=Array.from(s)}end(e,n){this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}}attribute(e,n){this.attributes.set(e,n)}event(e,n,r){this.events.push([e,n,r??{}])}addLinks(e){this.links.push(...e)}}const Qm=Ym({span:(t,e,n,r,s,i)=>new zm(t,e,n,r,s,i),context:t=>t()}),Xm=f(Ys(),Ve(Ei,am()),Ve(au,Bm),Ve(Km,Wm(Math.random())),Ve(Em,Fm()),Ve(uu,Qm)),ir=R(Symbol.for("effect/DefaultServices/currentServices"),()=>Ha(Xm));function Zm(t){return new xt(t)}function t_(){return Zm(new Map)}const Ao=Symbol.for("effect/FiberRefs");class xt{locals;[Ao]=Ao;constructor(e){this.locals=e}pipe(){return y(this,arguments)}}const e_=(t,e,n,r=!1)=>{const s=t;let i=e,o=n,c=r,a;for(;a===void 0;)if(tt(i)&&tt(o)){const l=X(i)[0],d=he(i),h=X(o)[0],p=X(o)[1],g=he(o);l.startTimeMillis<h.startTimeMillis?(o=g,c=!0):l.startTimeMillis>h.startTimeMillis?i=d:l.id<h.id?(o=g,c=!0):l.id>h.id?i=d:a=[p,c]}else a=[s.initial,!0];return a},n_=u(3,(t,e,n)=>{const r=new Map(t.locals);return n.locals.forEach((s,i)=>{const o=s[0][1];if(!s[0][0][k](e)){if(!r.has(i)){if(v(o,i.initial))return;r.set(i,[[e,i.join(i.initial,o)]]);return}const c=r.get(i),[a,l]=e_(i,c,s);if(l){const d=i.diff(a,o),h=c[0][1],p=i.join(h,i.patch(d)(h));if(!v(h,p)){let g;const m=c[0][0];m[k](e)?g=[[m,p],...c.slice(1)]:g=[[e,p],...c],r.set(i,g)}}}}),new xt(r)}),r_=u(2,(t,e)=>{const n=new Map;return fu(t,n,e),new xt(n)}),fu=(t,e,n)=>{t.locals.forEach((r,s)=>{const i=r[0][1],o=s.patch(s.fork)(i);v(i,o)?e.set(s,r):e.set(s,[[n,o],...r])})},hu=u(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new xt(n)}),s_=u(2,(t,e)=>t.locals.has(e)?M(X(t.locals.get(e))[1]):S()),cn=u(2,(t,e)=>f(s_(t,e),Wt(()=>e.initial))),vs=u(2,(t,{fiberId:e,fiberRef:n,value:r})=>{if(t.locals.size===0)return new xt(new Map([[n,[[e,r]]]]));const s=new Map(t.locals);return ws(s,e,n,r),new xt(s)}),ws=(t,e,n,r)=>{const s=t.get(n)??[];let i;if(tt(s)){const[o,c]=X(s);if(o[k](e)){if(v(c,r))return;i=[[e,r],...s.slice(1)]}else i=[[e,r],...s]}else i=[[e,r]];t.set(n,i)},i_=u(2,(t,{entries:e,forkAs:n})=>{if(t.locals.size===0)return new xt(new Map(e));const r=new Map(t.locals);return n!==void 0&&fu(t,r,n),e.forEach(([s,i])=>{i.length===1?ws(r,i[0][0],s,i[0][1]):i.forEach(([o,c])=>{ws(r,o,s,c)})}),new xt(r)}),o_=cn,c_=i_,a_=t_,u_=wg,l_=Ig,f_=Og,h_=Ba,d_=Va,p_=Ka,g_=Eg,m_=$g,__=f(Ze,Jl(t=>t.ordinal)),y_=Hl(__),b_=t=>{switch(t){case"All":return u_;case"Debug":return p_;case"Error":return f_;case"Fatal":return l_;case"Info":return d_;case"Trace":return g_;case"None":return m_;case"Warning":return h_}},du=t=>t.replace(/[\s="]/g,"_"),S_=t=>e=>`${du(e.label)}=${t-e.startTime}ms`,k_=fn,v_=Al;class w_ extends v_{}const pu="Empty",gu="Add",mu="Remove",_u="Update",yu="AndThen",I_={_tag:pu},O_=(t,e)=>{const n=new Map(t.locals);let r=I_;for(const[s,i]of e.locals.entries()){const o=X(i)[1],c=n.get(s);if(c!==void 0){const a=X(c)[1];v(a,o)||(r=Yr({_tag:_u,fiberRef:s,patch:s.diff(a,o)})(r))}else r=Yr({_tag:gu,fiberRef:s,value:o})(r);n.delete(s)}for(const[s]of n.entries())r=Yr({_tag:mu,fiberRef:s})(r);return r},Yr=u(2,(t,e)=>({_tag:yu,first:t,second:e})),E_=u(3,(t,e,n)=>{let r=n,s=ft(t);for(;tt(s);){const i=X(s),o=he(s);switch(i._tag){case pu:{s=o;break}case gu:{r=vs(r,{fiberId:e,fiberRef:i.fiberRef,value:i.value}),s=o;break}case mu:{r=hu(r,i.fiberRef),s=o;break}case _u:{const c=cn(r,i.fiberRef);r=vs(r,{fiberId:e,fiberRef:i.fiberRef,value:i.fiberRef.patch(i.patch)(c)}),s=o;break}case yu:{s=Wn(i.first)(Wn(i.second)(o));break}}}return r}),bu="effect/MetricLabel",Is=Symbol.for(bu);class $_{key;value;[Is]=Is;_hash;constructor(e,n){this.key=e,this.value=n,this._hash=x(bu+this.key+this.value)}[w](){return this._hash}[k](e){return R_(e)&&this.key===e.key&&this.value===e.value}pipe(){return y(this,arguments)}}const M_=(t,e)=>new $_(t,e),R_=t=>O(t,Is),T_=t=>{let e,n;typeof t=="function"?e=t:(e=t.try,n=t.catch);const r=s=>n?pi(()=>n(s)):Y(new Ya(s,"An unknown error occurred in Effect.tryPromise"));return e.length>=1?Zt((s,i)=>{try{e(i).then(o=>s(C(o)),o=>s(r(o)))}catch(o){s(r(o))}}):Zt(s=>{try{e().then(i=>s(C(i)),i=>s(r(i)))}catch(i){s(r(i))}})},F_="Sequential",C_={_tag:F_},N_=O_,A_=E_,Nr="effect/FiberStatus",ee=Symbol.for(Nr),or="Done",Po="Running",xo="Suspended",P_=x(`${Nr}-${or}`);class x_{[ee]=ee;_tag=or;[w](){return P_}[k](e){return $i(e)&&e._tag===or}}class j_{runtimeFlags;[ee]=ee;_tag=Po;constructor(e){this.runtimeFlags=e}[w](){return f(_(Nr),E(_(this._tag)),E(_(this.runtimeFlags)),N(this))}[k](e){return $i(e)&&e._tag===Po&&this.runtimeFlags===e.runtimeFlags}}class L_{runtimeFlags;blockingOn;[ee]=ee;_tag=xo;constructor(e,n){this.runtimeFlags=e,this.blockingOn=n}[w](){return f(_(Nr),E(_(this._tag)),E(_(this.runtimeFlags)),E(_(this.blockingOn)),N(this))}[k](e){return $i(e)&&e._tag===xo&&this.runtimeFlags===e.runtimeFlags&&v(this.blockingOn,e.blockingOn)}}const D_=new x_,q_=t=>new j_(t),U_=(t,e)=>new L_(t,e),$i=t=>O(t,ee),B_=t=>t._tag===or,V_=D_,Su=q_,K_=U_,J_=B_,H_=Symbol.for("effect/Micro"),cr=Symbol.for("effect/Micro/MicroExit"),jo=Symbol.for("effect/Micro/MicroCause"),G_={_E:U};class ku extends globalThis.Error{_tag;traces;[jo];constructor(e,n,r){const s=`MicroCause.${e}`;let i,o,c;if(n instanceof globalThis.Error){i=`(${s}) ${n.name}`,o=n.message;const a=o.split(`
`).length;c=n.stack?`(${s}) ${n.stack.split(`
`).slice(0,a+3).join(`
`)}`:`${i}: ${o}`}else i=s,o=ue(n,0),c=`${i}: ${o}`;r.length>0&&(c+=`
    ${r.join(`
    `)}`),super(o),this._tag=e,this.traces=r,this[jo]=G_,this.name=i,this.stack=c}pipe(){return y(this,arguments)}toString(){return this.stack}[A](){return this.stack}}class W_ extends ku{defect;constructor(e,n=[]){super("Die",e,n),this.defect=e}}const Y_=(t,e=[])=>new W_(t,e);class z_ extends ku{constructor(e=[]){super("Interrupt","interrupted",e)}}const Q_=(t=[])=>new z_(t),X_=t=>t._tag==="Interrupt",Lo=Symbol.for("effect/Micro/MicroFiber"),Z_={_A:U,_E:U};class ty{context;interruptible;[Lo];_stack=[];_observers=[];_exit;_children;currentOpCount=0;constructor(e,n=!0){this.context=e,this.interruptible=n,this[Lo]=Z_}getRef(e){return jf(this.context,e)}addObserver(e){return this._exit?(e(this._exit),rl):(this._observers.push(e),()=>{const n=this._observers.indexOf(e);n>=0&&this._observers.splice(n,1)})}_interrupted=!1;unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(Ci))}unsafePoll(){return this._exit}evaluate(e){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(e);if(n===Fn)return;const r=Do.interruptChildren&&Do.interruptChildren(this);if(r!==void 0)return this.evaluate(ur(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(e){let n=!1,r=e;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(Ni).shouldYield(this)){n=!0;const s=r;r=ur(iy,()=>s)}if(r=r[Os](this),r===Fn){const s=this._yielded;return cr in s?(this._yielded=void 0,s):Fn}}}catch(s){return O(r,Os)?Es(s):Es(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(e){for(;;){const n=this._stack.pop();if(!n)return;const r=n[ar]&&n[ar](this);if(r)return{[e]:r};if(n[e])return n}}_yielded=void 0;yieldWith(e){return this._yielded=e,Fn}children(){return this._children??=new Set}}const Do=R("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),vu=Symbol.for("effect/Micro/identifier"),D=Symbol.for("effect/Micro/args"),Os=Symbol.for("effect/Micro/evaluate"),Re=Symbol.for("effect/Micro/successCont"),ae=Symbol.for("effect/Micro/failureCont"),ar=Symbol.for("effect/Micro/ensureCont"),Fn=Symbol.for("effect/Micro/Yield"),ey={_A:U,_E:U,_R:U},ny={...k_,_op:"Micro",[H_]:ey,pipe(){return y(this,arguments)},[Symbol.iterator](){return new Yo(new an(this))},toJSON(){return{_id:"Micro",op:this[vu],...D in this?{args:this[D]}:void 0}},toString(){return V(this)},[A](){return V(this)}};function ry(t){return Es("Micro.evaluate: Not implemented")}const Ar=t=>({...ny,[vu]:t.op,[Os]:t.eval??ry,[Re]:t.contA,[ae]:t.contE,[ar]:t.ensure}),Mi=t=>{const e=Ar(t);return function(){const n=Object.create(e);return n[D]=t.single===!1?arguments:arguments[0],n}},wu=t=>{const e={...Ar(t),[cr]:cr,_tag:t.op,get[t.prop](){return this[D]},toJSON(){return{_id:"MicroExit",_tag:t.op,[t.prop]:this[D]}},[k](n){return ay(n)&&n._tag===t.op&&v(this[D],n[D])},[w](){return N(this,E(x(t.op))(_(this[D])))}};return function(n){const r=Object.create(e);return r[D]=n,r[Re]=void 0,r[ae]=void 0,r[ar]=void 0,r}},Ri=wu({op:"Success",prop:"value",eval(t){const e=t.getCont(Re);return e?e[Re](this[D],t):t.yieldWith(this)}}),Iu=wu({op:"Failure",prop:"cause",eval(t){let e=t.getCont(ae);for(;X_(this[D])&&e&&t.interruptible;)e=t.getCont(ae);return e?e[ae](this[D],t):t.yieldWith(this)}}),sy=Mi({op:"Yield",eval(t){let e=!1;return t.getRef(Ni).scheduleTask(()=>{e||t.evaluate(uy)},this[D]??0),t.yieldWith(()=>{e=!0})}}),iy=sy(0),oy=Ri(void 0),Ti=Mi({op:"WithMicroFiber",eval(t){return this[D](t)}}),ur=u(2,(t,e)=>{const n=Object.create(cy);return n[D]=t,n[Re]=e,n}),cy=Ar({op:"OnSuccess",eval(t){return t._stack.push(this),this[D]}}),ay=t=>O(t,cr),Ou=Ri,Fi=Iu,Ci=Fi(Q_()),Es=t=>Fi(Y_(t)),uy=Ou(void 0),ly="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0);class Eu{tasks=[];running=!1;scheduleTask(e,n){this.tasks.push(e),this.running||(this.running=!0,ly(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){const e=this.tasks;this.tasks=[];for(let n=0,r=e.length;n<r;n++)e[n]()}shouldYield(e){return e.currentOpCount>=e.getRef(dy)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const fy=u(2,(t,e)=>Ti(n=>{const r=n.context;return n.context=e(r),my(t,()=>(n.context=r,oy))})),hy=u(2,(t,e)=>fy(t,Bf(e)));class dy extends $c()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class Ni extends $c()("effect/Micro/currentScheduler",{defaultValue:()=>new Eu}){}const py=u(2,(t,e)=>{const n=Object.create(gy);return n[D]=t,n[Re]=e.onSuccess,n[ae]=e.onFailure,n}),gy=Ar({op:"OnSuccessAndFailure",eval(t){return t._stack.push(this),this[D]}}),my=u(2,(t,e)=>yy(n=>py(n(t),{onFailure:r=>ur(e(Fi(r)),()=>Iu(r)),onSuccess:r=>ur(e(Ou(r)),()=>Ri(r))}))),$u=Mi({op:"SetInterruptible",ensure(t){if(t.interruptible=this[D],t._interrupted&&t.interruptible)return()=>Ci}}),_y=t=>Ti(e=>e.interruptible?t:(e.interruptible=!0,e._stack.push($u(!1)),e._interrupted?Ci:t)),yy=t=>Ti(e=>e.interruptible?(e.interruptible=!1,e._stack.push($u(!0)),t(_y)):t(U)),by=(t,e)=>{const n=new ty(Ni.context(new Eu));return n.evaluate(t),n};class Sy{buckets=[];scheduleTask(e,n){const r=this.buckets.length;let s,i=0;for(;i<r&&this.buckets[i][0]<=n;i++)s=this.buckets[i];s&&s[0]===n?s[1].push(e):i===r?this.buckets.push([n,[e]]):this.buckets.splice(i,0,[n,[e]])}}class ky{maxNextTickBeforeTimer;running=!1;tasks=new Sy;constructor(e){this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let i=0;i<s.length;i++)s[i]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(Pg)?e.getFiberRef(wi):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const vy=R(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new ky(2048)),Mu=R(Symbol.for("effect/FiberRef/currentScheduler"),()=>lt(vy)),Ru=R(Symbol.for("effect/FiberRef/currentRequestMap"),()=>lt(new Map)),Ai="InterruptSignal",Pi="Stateful",xi="Resume",ji="YieldNow",zr=t=>({_tag:Ai,cause:t}),Un=t=>({_tag:Pi,onFiber:t}),re=t=>({_tag:xi,effect:t}),wy=()=>({_tag:ji}),Iy="effect/FiberScope",lr=Symbol.for(Iy);class Oy{[lr]=lr;fiberId=Se;roots=new Set;add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}class Ey{fiberId;parent;[lr]=lr;constructor(e,n){this.fiberId=e,this.parent=n}add(e,n){this.parent.tell(Un(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const $y=t=>new Ey(t.id(),t),Li=R(Symbol.for("effect/FiberScope/Global"),()=>new Oy),My="effect/Fiber",Ry=Symbol.for(My),Ty={_E:t=>t,_A:t=>t},Fy="effect/Fiber",Cy=Symbol.for(Fy),Tu=t=>Da(Na(t.await),t.inheritAll);({...hn});const Lt="effect/FiberCurrent",Ny="effect/Logger",Ay=Symbol.for(Ny),Py={_Message:t=>t,_Output:t=>t},Di=t=>({[Ay]:Py,log:t,pipe(){return y(this,arguments)}}),xy=/^[^\s"=]*$/,jy=(t,e)=>({annotations:n,cause:r,date:s,fiberId:i,logLevel:o,message:c,spans:a})=>{const l=m=>m.match(xy)?m:t(m),d=(m,$)=>`${du(m)}=${l($)}`,h=(m,$)=>" "+d(m,$);let p=d("timestamp",s.toISOString());p+=h("level",o.label),p+=h("fiber",Xc(i));const g=ef(c);for(let m=0;m<g.length;m++)p+=h("message",ue(g[m],e));Bp(r)||(p+=h("cause",_n(r,{renderErrorCause:!0})));for(const m of a)p+=" "+S_(s.getTime())(m);for(const[m,$]of n)p+=h(m,ue($,e));return p},Ly=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,Dy=Di(jy(Ly)),qy=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null;qy&&process.stdout.isTTY;const Fu="effect/MetricBoundaries",$s=Symbol.for(Fu);class Uy{values;[$s]=$s;constructor(e){this.values=e,this._hash=f(x(Fu),E(un(this.values)))}_hash;[w](){return this._hash}[k](e){return By(e)&&v(this.values,e.values)}pipe(){return y(this,arguments)}}const By=t=>O(t,$s),Vy=t=>{const e=f(t,mc(et(Number.POSITIVE_INFINITY)),kf);return new Uy(e)},Ky=t=>f(tf(t.count-1,e=>t.start*Math.pow(t.factor,e)),yr,Vy),Jy="effect/MetricKeyType",Cu=Symbol.for(Jy),Nu="effect/MetricKeyType/Counter",Ms=Symbol.for(Nu),Hy="effect/MetricKeyType/Frequency",Gy=Symbol.for(Hy),Wy="effect/MetricKeyType/Gauge",Yy=Symbol.for(Wy),Au="effect/MetricKeyType/Histogram",Rs=Symbol.for(Au),zy="effect/MetricKeyType/Summary",Qy=Symbol.for(zy),Pu={_In:t=>t,_Out:t=>t};class Xy{incremental;bigint;[Cu]=Pu;[Ms]=Ms;constructor(e,n){this.incremental=e,this.bigint=n,this._hash=x(Nu)}_hash;[w](){return this._hash}[k](e){return xu(e)}pipe(){return y(this,arguments)}}class Zy{boundaries;[Cu]=Pu;[Rs]=Rs;constructor(e){this.boundaries=e,this._hash=f(x(Au),E(_(this.boundaries)))}_hash;[w](){return this._hash}[k](e){return ju(e)&&v(this.boundaries,e.boundaries)}pipe(){return y(this,arguments)}}const tb=t=>new Xy(t?.incremental??!1,t?.bigint??!1),eb=t=>new Zy(t),xu=t=>O(t,Ms),nb=t=>O(t,Gy),rb=t=>O(t,Yy),ju=t=>O(t,Rs),sb=t=>O(t,Qy),ib="effect/MetricKey",Lu=Symbol.for(ib),ob={_Type:t=>t},cb=Gs(v);class qi{name;keyType;description;tags;[Lu]=ob;constructor(e,n,r,s=[]){this.name=e,this.keyType=n,this.description=r,this.tags=s,this._hash=f(x(this.name+this.description),E(_(this.keyType)),E(un(this.tags)))}_hash;[w](){return this._hash}[k](e){return ab(e)&&this.name===e.name&&v(this.keyType,e.keyType)&&v(this.description,e.description)&&cb(this.tags,e.tags)}pipe(){return y(this,arguments)}}const ab=t=>O(t,Lu),ub=(t,e)=>new qi(t,tb(e),Js(e?.description)),lb=(t,e,n)=>new qi(t,eb(e),Js(n)),fb=u(2,(t,e)=>e.length===0?t:new qi(t.name,t.keyType,t.description,xn(t.tags,e))),hb="effect/MetricState",kn=Symbol.for(hb),Du="effect/MetricState/Counter",Ts=Symbol.for(Du),qu="effect/MetricState/Frequency",Fs=Symbol.for(qu),Uu="effect/MetricState/Gauge",Cs=Symbol.for(Uu),Bu="effect/MetricState/Histogram",Ns=Symbol.for(Bu),Vu="effect/MetricState/Summary",As=Symbol.for(Vu),vn={_A:t=>t};class db{count;[kn]=vn;[Ts]=Ts;constructor(e){this.count=e}[w](){return f(_(Du),E(_(this.count)),N(this))}[k](e){return Ib(e)&&this.count===e.count}pipe(){return y(this,arguments)}}const pb=Gs(v);class gb{occurrences;[kn]=vn;[Fs]=Fs;constructor(e){this.occurrences=e}_hash;[w](){return f(x(qu),E(un(B(this.occurrences.entries()))),N(this))}[k](e){return Ob(e)&&pb(B(this.occurrences.entries()),B(e.occurrences.entries()))}pipe(){return y(this,arguments)}}class mb{value;[kn]=vn;[Cs]=Cs;constructor(e){this.value=e}[w](){return f(_(Uu),E(_(this.value)),N(this))}[k](e){return Eb(e)&&this.value===e.value}pipe(){return y(this,arguments)}}class _b{buckets;count;min;max;sum;[kn]=vn;[Ns]=Ns;constructor(e,n,r,s,i){this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=i}[w](){return f(_(Bu),E(_(this.buckets)),E(_(this.count)),E(_(this.min)),E(_(this.max)),E(_(this.sum)),N(this))}[k](e){return $b(e)&&v(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}class yb{error;quantiles;count;min;max;sum;[kn]=vn;[As]=As;constructor(e,n,r,s,i,o){this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=i,this.sum=o}[w](){return f(_(Vu),E(_(this.error)),E(_(this.quantiles)),E(_(this.count)),E(_(this.min)),E(_(this.max)),E(_(this.sum)),N(this))}[k](e){return Mb(e)&&this.error===e.error&&v(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}const bb=t=>new db(t),Sb=t=>new gb(t),kb=t=>new mb(t),vb=t=>new _b(t.buckets,t.count,t.min,t.max,t.sum),wb=t=>new yb(t.error,t.quantiles,t.count,t.min,t.max,t.sum),Ib=t=>O(t,Ts),Ob=t=>O(t,Fs),Eb=t=>O(t,Cs),$b=t=>O(t,Ns),Mb=t=>O(t,As),Rb="effect/MetricHook",Tb=Symbol.for(Rb),Fb={_In:t=>t,_Out:t=>t},wn=t=>({[Tb]:Fb,pipe(){return y(this,arguments)},...t}),qo=BigInt(0),Cb=t=>{let e=t.keyType.bigint?qo:0;const n=t.keyType.incremental?t.keyType.bigint?s=>s>=qo:s=>s>=0:s=>!0,r=s=>{n(s)&&(e=e+s)};return wn({get:()=>bb(e),update:r,modify:r})},Nb=t=>{const e=new Map;for(const r of t.keyType.preregisteredWords)e.set(r,0);const n=r=>{const s=e.get(r)??0;e.set(r,s+1)};return wn({get:()=>Sb(e),update:n,modify:n})},Ab=(t,e)=>{let n=e;return wn({get:()=>kb(n),update:r=>{n=r},modify:r=>{n=n+r}})},Pb=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float64Array(n);let i=0,o=0,c=Number.MAX_VALUE,a=Number.MIN_VALUE;f(e,Yn(Ze),ie((h,p)=>{s[p]=h}));const l=h=>{let p=0,g=n;for(;p!==g;){const m=Math.floor(p+(g-p)/2),$=s[m];h<=$?g=m:p=m,g===p+1&&(h<=s[p]?g=p:p=g)}r[p]=r[p]+1,i=i+1,o=o+h,h<c&&(c=h),h>a&&(a=h)},d=()=>{const h=Hs(n);let p=0;for(let g=0;g<n;g++){const m=s[g],$=r[g];p=p+$,h[g]=[m,p]}return h};return wn({get:()=>vb({buckets:d(),count:i,min:c,max:a,sum:o}),update:l,modify:l})},xb=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,i=f(s,Yn(Ze)),o=Hs(r);let c=0,a=0,l=0,d=0,h=0;const p=m=>{const $=[];let F=0;for(;F!==r-1;){const K=o[F];if(K!=null){const[J,wt]=K,nt=os(m-J);ph(nt,Pc)&&dh(nt,n)&&$.push(wt)}F=F+1}return jb(e,i,Yn($,Ze))},g=(m,$)=>{if(r>0){c=c+1;const F=c%r;o[F]=[$,m]}d=a===0?m:Math.min(d,m),h=a===0?m:Math.max(h,m),a=a+1,l=l+m};return wn({get:()=>wb({error:e,quantiles:p(Date.now()),count:a,min:d,max:h,sum:l}),update:([m,$])=>g(m,$),modify:([m,$])=>g(m,$)})},jb=(t,e,n)=>{const r=n.length;if(!tt(e))return de();const s=e[0],i=e.slice(1),o=Uo(t,r,S(),0,s,n),c=ft(o);return i.forEach(a=>{c.push(Uo(t,r,o.value,o.consumed,a,o.rest))}),ie(c,a=>[a.quantile,a.value])},Uo=(t,e,n,r,s,i)=>{let o=t,c=e,a=n,l=r,d=s,h=i,p=t,g=e,m=n,$=r,F=s,K=i;for(;;){if(!tt(h))return{quantile:d,value:S(),consumed:l,rest:[]};if(d===1)return{quantile:d,value:M(bc(h)),consumed:l+h.length,rest:[]};const J=X(h),wt=ff(h,P=>P===J),nt=d*c,De=o/2*nt,It=l+wt[0].length,In=Math.abs(It-nt);if(It<nt-De){p=o,g=c,m=ze(h),$=It,F=d,K=wt[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}if(It>nt+De){const P=Q(a)?M(J):a;return{quantile:d,value:P,consumed:l,rest:h}}switch(a._tag){case"None":{p=o,g=c,m=ze(h),$=It,F=d,K=wt[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}case"Some":{const P=Math.abs(nt-a.value);if(In<P){p=o,g=c,m=ze(h),$=It,F=d,K=wt[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}return{quantile:d,value:M(a.value),consumed:l,rest:h}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},Lb="effect/MetricPair",Db=Symbol.for(Lb),qb={_Type:t=>t},Ub=(t,e)=>({[Db]:qb,metricKey:t,metricState:e,pipe(){return y(this,arguments)}}),Bb="effect/MetricRegistry",Bo=Symbol.for(Bb);class Vb{[Bo]=Bo;map=em();snapshot(){const e=[];for(const[n,r]of this.map)e.push(Ub(n,r.get()));return e}get(e){const n=f(this.map,qt(e),Dt);if(n==null){if(xu(e.keyType))return this.getCounter(e);if(rb(e.keyType))return this.getGauge(e);if(nb(e.keyType))return this.getFrequency(e);if(ju(e.keyType))return this.getHistogram(e);if(sb(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Cb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getFrequency(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Nb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getGauge(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Ab(e,e.keyType.bigint?BigInt(0):0);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getHistogram(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Pb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getSummary(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=xb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}}const Kb=()=>new Vb,Jb="effect/Metric",Hb=Symbol.for(Jb),Gb={_Type:t=>t,_In:t=>t,_Out:t=>t},Vo=R(Symbol.for("effect/Metric/globalMetricRegistry"),()=>Kb()),Ku=function(t,e,n,r){const s=Object.assign(i=>bg(i,o=>Qb(s,o)),{[Hb]:Gb,keyType:t,unsafeUpdate:e,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return y(this,arguments)}});return s},Pr=(t,e)=>Ju(ub(t,e)),Ju=t=>{let e;const n=new WeakMap,r=s=>{if(s.length===0)return e!==void 0||(e=Vo.get(t)),e;let i=n.get(s);return i!==void 0||(i=Vo.get(fb(t,s)),n.set(s,i)),i};return Ku(t.keyType,(s,i)=>r(i).update(s),s=>r(s).get(),(s,i)=>r(i).modify(s))},Wb=(t,e,n)=>Ju(lb(t,e,n)),Yb=u(3,(t,e,n)=>zb(t,[M_(e,n)])),zb=u(2,(t,e)=>Ku(t.keyType,(n,r)=>t.unsafeUpdate(n,xn(e,r)),n=>t.unsafeValue(xn(e,n)),(n,r)=>t.unsafeModify(n,xn(e,r)))),Qb=u(2,(t,e)=>Ja(Ss,n=>b(()=>t.unsafeUpdate(e,n))));({...Vs});const Xb=u(2,(t,e)=>Ja(Ru,n=>b(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,Xa(r.result,e))}}))),Zb="effect/Supervisor",xr=Symbol.for(Zb),Ui={_T:t=>t};class jr{underlying;value0;[xr]=Ui;constructor(e,n){this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Lr(this,e)}}class Lr{left;right;_tag="Zip";[xr]=Ui;constructor(e,n){this.left=e,this.right=n}get value(){return La(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Lr(this,e)}}const Hu=t=>O(t,xr)&&Wo(t,"Zip");class tS{effect;[xr]=Ui;constructor(e){this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Lr(this,e)}onRun(e,n){return e()}}const eS=t=>new tS(t),Dr=R("effect/Supervisor/none",()=>eS(kt)),nS=Ce,Gu="Empty",Wu="AddSupervisor",Yu="RemoveSupervisor",zu="AndThen",Xe={_tag:Gu},Bn=(t,e)=>({_tag:zu,first:t,second:e}),rS=(t,e)=>sS(e,et(t)),sS=(t,e)=>{let n=t,r=e;for(;me(r);){const s=_e(r);switch(s._tag){case Gu:{r=Ut(r);break}case Wu:{n=n.zip(s.supervisor),r=Ut(r);break}case Yu:{n=Ps(n,s.supervisor),r=Ut(r);break}case zu:{r=pt(s.first)(pt(s.second)(Ut(r)));break}}}return n},Ps=(t,e)=>v(t,e)?Dr:Hu(t)?Ps(t.left,e).zip(Ps(t.right,e)):t,fr=t=>v(t,Dr)?zt():Hu(t)?f(fr(t.left),nn(fr(t.right))):ii(t),iS=(t,e)=>{if(v(t,e))return Xe;const n=fr(t),r=fr(e),s=f(r,eo(n),Xn(Xe,(o,c)=>Bn(o,{_tag:Wu,supervisor:c}))),i=f(n,eo(r),Xn(Xe,(o,c)=>Bn(o,{_tag:Yu,supervisor:c})));return Bn(s,i)},oS=nS({empty:Xe,patch:rS,combine:Bn,diff:iS}),cS=Pr("effect_fiber_started",{incremental:!0}),Ko=Pr("effect_fiber_active"),aS=Pr("effect_fiber_successes",{incremental:!0}),uS=Pr("effect_fiber_failures",{incremental:!0}),lS=Yb(Wb("effect_fiber_lifetimes",Ky({start:.5,factor:2,count:35})),"time_unit","milliseconds"),He="Continue",fS="Done",Jo="Yield",hS={_E:t=>t,_A:t=>t},Cn=t=>{throw new Error(`BUG: FiberRuntime - ${ue(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Et=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),$t=R("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Ge={[Jn]:(t,e,n)=>z(()=>e.effect_instruction_i1(n)),OnStep:(t,e,n)=>L(L(n)),[Hn]:(t,e,n)=>z(()=>e.effect_instruction_i2(n)),[Us]:(t,e,n)=>(t.patchRuntimeFlags(t.currentRuntimeFlags,e.patch),Nt(t.currentRuntimeFlags)&&t.isInterrupted()?T(t.getInterruptedCause()):L(n)),[Gn]:(t,e,n)=>(z(()=>e.effect_instruction_i2(n)),z(()=>e.effect_instruction_i0())?(t.pushStack(e),z(()=>e.effect_instruction_i1())):kt),[An]:(t,e,n)=>{for(;;){const r=z(()=>e.effect_instruction_i0.next(n));if(r.done)return L(r.value);const s=yl(r.value);if(Cr(s)){if(s._tag==="Failure")return s}else return t.pushStack(e),s;n=s.value}}},dS={[Ai]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),Nt(e)?T(r.cause):n),[xi]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Pi]:(t,e,n,r)=>(r.onFiber(t,Su(e)),n),[ji]:(t,e,n,r)=>I(Si(),()=>n)},pS=t=>mi(Op(t),e=>Xu(Dp(e),([n,r])=>{const s=new Map,i=[];for(const c of r){i.push(Ht(c));for(const a of c)s.set(a.request,a)}const o=i.flat();return vi(ES(n.runAll(i),o,()=>o.forEach(c=>{c.listeners.interrupted=!0})),Ru,s)},!1,!1)),gS=Bs();class Qu extends w_{[Ry]=Ty;[Cy]=hS;_fiberRefs;_fiberId;_queue=new Array;_children=null;_observers=new Array;_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_isYielding=!1;currentRuntimeFlags;currentOpCount=0;currentSupervisor;currentScheduler;currentTracer;currentSpan;currentContext;currentDefaultServices;constructor(e,n,r){if(super(),this.currentRuntimeFlags=r,this._fiberId=e,this._fiberRefs=n,oo(r)){const s=this.getFiberRef(Ss);cS.unsafeUpdate(1,s),Ko.unsafeUpdate(1,s)}this.refreshRefCache()}commit(){return Tu(this)}id(){return this._fiberId}resume(e){this.tell(re(e))}get status(){return this.ask((e,n)=>n)}get runtimeFlags(){return this.ask((e,n)=>J_(n)?e.currentRuntimeFlags:n.runtimeFlags)}scope(){return $y(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Tn)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return G(()=>{const n=Qg(this._fiberId);return this.tell(Un((r,s)=>{Xa(n,b(()=>e(r,s)))})),Qa(n)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Zt(e=>{const n=r=>e(C(r));return this.tell(Un((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),b(()=>this.tell(Un((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return gt((e,n)=>{const r=e.id(),s=e.getFiberRefs(),i=n.runtimeFlags,o=this.getFiberRefs(),c=n_(s,r,o);e.setFiberRefs(c);const a=e.getFiberRef(Ho),l=f(Dn(i,a),ao(Ne),ao(_s));return kg(l)})}get poll(){return b(()=>Js(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return b(()=>this.tell(zr(At(e))))}unsafeInterruptAsFork(e){this.tell(zr(At(e)))}addObserver(e){this._exitValue!==null?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(n=>n!==e)}getFiberRefs(){return this.setFiberRef(Ho,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=hu(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,n){this._fiberRefs=vs(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:n}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(ir),this.currentTracer=this.currentDefaultServices.unsafeMap.get(uu.key),this.currentSupervisor=this.getFiberRef(OS),this.currentScheduler=this.getFiberRef(Mu),this.currentContext=this.getFiberRef(Fr),this.currentSpan=this.currentContext.unsafeMap.get(lu.key)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}transferChildren(e){const n=this._children;if(this._children=null,n!==null&&n.size>0)for(const r of n)r._exitValue===null&&e.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let n=He;const r=globalThis[Lt];globalThis[Lt]=this;try{for(;n===He;)n=this._queue.length===0?fS:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Lt]=r}this._queue.length>0&&!this._running?(this._running=!0,n===Jo?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(wi))}drainQueueWhileRunning(e,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=dS[s._tag](this,e,r,s)}return r}isInterrupted(){return!Vp(this.getFiberRef(Tn))}addInterruptedCause(e){const n=this.getFiberRef(Tn);this.setFiberRef(Tn,ot(n,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let e=!1;for(const n of this._children)n.tell(zr(At(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const e=this._children.values();this._children=null;let n=!1;return bi({while:()=>!n,body:()=>{const s=e.next();return s.done?b(()=>{n=!0}):Sn(s.value.await)},step:()=>{}})}return null}reportExitValue(e){if(oo(this.currentRuntimeFlags)){const n=this.getFiberRef(Ss),r=this.id().startTimeMillis,s=Date.now();switch(lS.unsafeUpdate(s-r,n),Ko.unsafeUpdate(-1,n),e._tag){case ut:{aS.unsafeUpdate(1,n);break}case at:{uS.unsafeUpdate(1,n);break}}}if(e._tag==="Failure"){const n=this.getFiberRef(qg);!fi(e.cause)&&n._tag==="Some"&&this.log("Fiber terminated with an unhandled error",e.cause,n)}}setExitValue(e){this._exitValue=e,this.reportExitValue(e);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](e);this._observers=[]}getLoggers(){return this.getFiberRef(SS)}log(e,n,r){const s=St(r)?r.value:this.getFiberRef(jg),i=this.getFiberRef(mS);if(y_(i,s))return;const o=this.getFiberRef(Lg),c=this.getFiberRef(xg),a=this.getLoggers(),l=this.getFiberRefs();if(Gc(a)>0){const d=Oc(this.getFiberRef(ir),Ei),h=new Date(d.unsafeCurrentTimeMillis());wl(l,()=>{for(const p of a)p.log({fiberId:this.id(),logLevel:s,message:e,cause:n,context:l,spans:o,annotations:c,date:h})})}}evaluateMessageWhileSuspended(e){switch(e._tag){case ji:return Jo;case Ai:return this.processNewInterruptSignal(e.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(T(e.cause)),this._asyncInterruptor=null),He;case xi:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),He;case Pi:return e.onFiber(this,this._exitValue!==null?V_:K_(this.currentRuntimeFlags,this._asyncBlockingOn)),He;default:return Cn(e)}}evaluateEffect(e){this.currentSupervisor.onResume(this);try{let n=Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(this.getInterruptedCause()):e;for(;n!==null;){const r=n,s=this.runLoop(r);if(s===Et){const i=$t.currentOp;$t.currentOp=null,i._op===Pn?Sp(this.currentRuntimeFlags)?(this.tell(wy()),this.tell(re(Vt)),n=null):n=Vt:i._op===Ye&&(n=null)}else{this.currentRuntimeFlags=f(this.currentRuntimeFlags,kp(_s));const i=this.interruptAllChildren();i!==null?n=I(i,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(re(s)),n=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(e){if(this._running)this.tell(re(e));else{this._running=!0;const n=globalThis[Lt];globalThis[Lt]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[Lt]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(re(e))}patchRuntimeFlags(e,n){const r=qn(e,n);return globalThis[Lt]=this,this.currentRuntimeFlags=r,r}initiateAsync(e,n){let r=!1;const s=i=>{r||(r=!0,this.tell(re(i)))};Nt(e)&&(this._asyncInterruptor=s);try{n(s)}catch(i){s(mt(Tt(i)))}}pushStack(e){this._stack.push(e),e._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const e=this._stack.pop();if(e)return e._op==="OnStep"&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==Ur)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==Jn&&e._op!==Gn&&e._op!==An)return e;e=this.popStack()}}[Ol](e){return b(()=>Ec(this.currentContext,e))}Left(e){return Y(e.left)}None(e){return Y(new Wa)}Right(e){return L(e.right)}Some(e){return L(e.value)}Micro(e){return rr(n=>{let r=n;const s=by(hy(e,this.currentContext));return s.addObserver(i=>{if(i._tag==="Success")return r(L(i.value));switch(i.cause._tag){case"Interrupt":return r(T(At(Se)));case"Fail":return r(Y(i.cause.error));case"Die":return r(go(i.cause.defect))}}),rr(i=>{r=o=>{i(kt)},s.unsafeInterrupt()})})}[ec](e){const n=z(()=>e.effect_instruction_i0()),r=this.getNextSuccessCont();return r!==void 0?(r._op in Ge||Cn(r),Ge[r._op](this,r,n)):($t.currentOp=L(n),Et)}[ut](e){const n=e,r=this.getNextSuccessCont();return r!==void 0?(r._op in Ge||Cn(r),Ge[r._op](this,r,n.effect_instruction_i0)):($t.currentOp=n,Et)}[at](e){const n=e.effect_instruction_i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case Ur:case Hn:return Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(uo(n)):z(()=>r.effect_instruction_i1(n));case"OnStep":return Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(uo(n)):L(T(n));case Us:return this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(ot(n,this.getInterruptedCause())):T(n);default:Cn(r)}else return $t.currentOp=T(n),Et}[nc](e){return z(()=>e.effect_instruction_i0(this,Su(this.currentRuntimeFlags)))}Blocked(e){const n=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){const s=[],i=this._steps[this._steps.length-1];let o=this.popStack();for(;o&&o._op!=="OnStep";)s.push(o),o=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;const c=N_(i.refs,n),a=Dn(i.flags,r);return L(Ea(e.effect_instruction_i0,gt(l=>{for(;s.length>0;)l.pushStack(s.pop());return l.setFiberRefs(A_(l.id(),l.getFiberRefs())(c)),l.currentRuntimeFlags=qn(a)(l.currentRuntimeFlags),e.effect_instruction_i1})))}return Tr(s=>I(Zu(fg(e.effect_instruction_i0)),()=>s(e.effect_instruction_i1)))}RunBlocked(e){return pS(e.effect_instruction_i0)}[ln](e){const n=e.effect_instruction_i0,r=this.currentRuntimeFlags,s=qn(r,n);if(Nt(s)&&this.isInterrupted())return T(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,n),e.effect_instruction_i1){const i=Dn(s,r);return this.pushStack(new hg(i,e)),z(()=>e.effect_instruction_i1(r))}else return Vt}[Jn](e){return this.pushStack(e),e.effect_instruction_i0}OnStep(e){return this.pushStack(e),e.effect_instruction_i0}[Ur](e){return this.pushStack(e),e.effect_instruction_i0}[Hn](e){return this.pushStack(e),e.effect_instruction_i0}[Ye](e){return this._asyncBlockingOn=e.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,e.effect_instruction_i0),$t.currentOp=e,Et}[Pn](e){return this._isYielding=!1,$t.currentOp=e,Et}[Gn](e){const n=e.effect_instruction_i0,r=e.effect_instruction_i1;return n()?(this.pushStack(e),r()):Vt}[An](e){return Ge[An](this,e,void 0)}[_r](e){return z(()=>e.commit())}runLoop(e){let n=e;for(this.currentOpCount=0;;){if(this.currentRuntimeFlags&bp&&this.currentSupervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this.currentRuntimeFlags,n)),!this._isYielding){this.currentOpCount+=1;const r=this.currentScheduler.shouldYield(this);if(r!==!1){this._isYielding=!0,this.currentOpCount=0;const s=n;n=I(Si({priority:r}),()=>s)}}try{if(n=this.currentTracer.context(()=>{if(gS!==n[$e]._V){const r=this.getFiberRef(Ug);if(r._tag==="Some"){const s=n[$e]._V;this.log(`Executing an Effect versioned ${s} with a Runtime of version ${Bs()}, you may want to dedupe the effect dependencies, you can use the language service plugin to detect this at compile time: https://github.com/Effect-TS/language-service`,Ie,r)}}return this[n._op](n)},this),n===Et){const r=$t.currentOp;return r._op===Pn||r._op===Ye?Et:($t.currentOp=null,r._op===ut||r._op===at?r:T(Tt(r)))}}catch(r){n!==Et&&!O(n,"_op")||!(n._op in this)?n=gg(`Not a valid effect: ${ue(n)}`):Gg(r)?n=T(ot(Tt(r),At(Se))):n=go(r)}}}run=()=>{this.drainQueueOnCurrentThread()}}const mS=R("effect/FiberRef/currentMinimumLogLevel",()=>lt(b_("Info"))),_S=t=>Di(e=>{const n=o_(e.context,ir);Oc(n,au).unsafe.log(t.log(e))}),yS=R(Symbol.for("effect/Logger/defaultLogger"),()=>_S(Dy)),bS=R(Symbol.for("effect/Logger/tracerLogger"),()=>Di(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:i})=>{const o=Uf(cn(n,Fr),lu);if(o._tag==="None"||o.value._tag==="ExternalSpan")return;const c=Ec(cn(n,ir),Ei),a={};for(const[l,d]of t)a[l]=d;a["effect.fiberId"]=od(r),a["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(a["effect.cause"]=_n(e,{renderErrorCause:!0})),o.value.event(ue(Array.isArray(i)&&i.length===1?i[0]:i),c.unsafeCurrentTimeNanos(),a)})),SS=R(Symbol.for("effect/FiberRef/currentLoggers"),()=>Cg(ii(yS,bS))),Xu=(t,e,n,r,s)=>Tr(i=>Sg(o=>gt(c=>{let a=Array.from(t).reverse(),l=a.length;if(l===0)return kt;let d=0,h=!1;const p=a.length,g=new Set,m=new Array,$=()=>g.forEach(P=>{P.currentScheduler.scheduleTask(()=>{P.unsafeInterruptAsFork(c.id())},0)}),F=new Array,K=new Array,J=new Array,wt=()=>{const P=m.filter(({exit:Z})=>Z._tag==="Failure").sort((Z,_t)=>Z.index<_t.index?-1:Z.index===_t.index?0:1).map(({exit:Z})=>Z);return P.length===0&&P.push(Vt),P},nt=(P,Z=!1)=>{const _t=ja(o(P)),H=vS(_t,c,c.currentRuntimeFlags,Li);return c.currentScheduler.scheduleTask(()=>{Z&&H.unsafeInterruptAsFork(c.id()),H.resume(_t)},0),H},De=()=>{r||(l-=a.length,a=[]),h=!0,$()},It=Fa,In=nt(Zt(P=>{const Z=(H,Ot)=>{H._op==="Blocked"?J.push(H):(m.push({index:Ot,exit:H}),H._op==="Failure"&&!h&&De())},_t=()=>{if(a.length>0){const H=a.pop();let Ot=d++;const On=()=>{const rt=a.pop();return Ot=d++,I(Si(),()=>I(It(i(e(rt,Ot))),jt))},jt=rt=>a.length>0&&(Z(rt,Ot),a.length>0)?On():C(rt),En=I(It(i(e(H,Ot))),jt),yt=nt(En);F.push(yt),g.add(yt),h&&yt.currentScheduler.scheduleTask(()=>{yt.unsafeInterruptAsFork(c.id())},0),yt.addObserver(rt=>{let qe;if(rt._op==="Failure"?qe=rt:qe=rt.effect_instruction_i0,K.push(yt),g.delete(yt),Z(qe,Ot),m.length===l)P(C(Wt(So(wt(),{parallel:!0}),()=>Vt)));else if(J.length+m.length===l){const Vi=wt(),el=J.map(Ue=>Ue.effect_instruction_i0).reduce(ma);P(C(Ea(el,Xu([Wt(So(Vi,{parallel:!0}),()=>Vt),...J.map(Ue=>Ue.effect_instruction_i1)],Ue=>Ue,n,!0))))}else _t()})}};for(let H=0;H<p;H++)_t()}));return Sn(yi(Na(i(Tu(In))),za({onFailure:P=>{De();const Z=J.length+1,_t=Math.min(J.length,J.length),H=Array.from(J);return Zt(Ot=>{let On=0,jt=0;const En=(rt,qe)=>Vi=>{On++,On===Z&&Ot(L(T(P))),H.length>0&&qe&&yt()},yt=()=>{nt(H.pop(),!0).addObserver(En(jt,!0)),jt++};In.addObserver(En(jt,!1)),jt++;for(let rt=0;rt<_t;rt++)yt()})},onSuccess:()=>Bt(K,P=>P.inheritAll)})))}))),Zu=t=>wS(t,Li),kS=(t,e,n,r=null)=>{const s=tl(t,e,n,r);return s.resume(t),s},vS=(t,e,n,r=null)=>tl(t,e,n,r),tl=(t,e,n,r=null)=>{const s=Zc(),i=e.getFiberRefs(),o=r_(i,s),c=new Qu(s,o,n),a=cn(o,Fr),l=c.currentSupervisor;return l.onStart(a,t,M(e),c),c.addObserver(h=>l.onEnd(h,c)),(r!==null?r:f(e.getFiberRef(ks),Wt(()=>e.scope()))).add(n,c),c},wS=(t,e)=>gt((n,r)=>C(kS(t,n,r.runtimeFlags,e))),IS=t=>je(t,{differ:oS,fork:Xe}),Ho=Ag(vp),OS=IS(Dr),ES=(t,e,n)=>Ca(r=>I(I(Zu(Aa(t)),s=>Zt(i=>{const o=e.map(l=>l.listeners.count),c=()=>{o.every(l=>l===0)&&e.every(l=>l.result.state.current._tag==="Pending"?!0:!!(l.result.state.current._tag==="Done"&&Cr(l.result.state.current.effect)&&l.result.state.current.effect._tag==="Failure"&&Kp(l.result.state.current.effect.cause)))&&(a.forEach(l=>l()),n?.(),i(vg(s)))};s.addObserver(l=>{a.forEach(d=>d()),i(l)});const a=e.map((l,d)=>{const h=p=>{o[d]=p,c()};return l.listeners.addObserver(h),()=>l.listeners.removeObserver(h)});return c(),b(()=>{a.forEach(l=>l())})})),()=>G(()=>{const s=e.flatMap(i=>i.state.completed?[]:[i]);return mi(s,i=>Xb(i.request,Wg(r)))}))),$S=Vg,MS=Kg,Bi=t=>function(){if(arguments.length===1){const e=arguments[0];return(n,...r)=>t(e,n,...r)}return t.apply(this,arguments)},RS=Bi((t,e,n)=>{const r=Zc(),s=[[Fr,[[r,t.context]]]];n?.scheduler&&s.push([Mu,[[r,n.scheduler]]]);let i=c_(t.fiberRefs,{entries:s,forkAs:r});n?.updateRefs&&(i=n.updateRefs(i,r));const o=new Qu(r,i,t.runtimeFlags);let c=e;n?.scope&&(c=I(MS(n.scope,C_),l=>qa(Bg(l,Ca(d=>v(d,o.id())?kt:Ua(o,d))),yi(e,d=>$S(l,d)))));const a=o.currentSupervisor;return a!==Dr&&(a.onStart(t.context,c,S(),o),o.addObserver(l=>a.onEnd(l,o))),Li.add(t.runtimeFlags,o),n?.immediate===!1?o.resume(c):o.start(c),o}),Qr=Symbol.for("effect/Runtime/FiberFailure"),Nn=Symbol.for("effect/Runtime/FiberFailure/Cause");class TS extends Error{[Qr];[Nn];constructor(e){const n=Ia(e)[0];super(n?.message||"An error has occurred"),this[Qr]=Qr,this[Nn]=e,this.name=n?`(FiberFailure) ${n.name}`:"FiberFailure",n?.stack&&(this.stack=n.stack)}toJSON(){return{_id:"FiberFailure",cause:this[Nn].toJSON()}}toString(){return"(FiberFailure) "+_n(this[Nn],{renderErrorCause:!0})}[A](){return this.toString()}}const FS=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new TS(t);return Error.stackTraceLimit=e,n},CS=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return ko(e.left);case"Right":return L(e.right);case"Some":return L(e.value);case"None":return ko(new Wa)}},NS=Bi((t,e,n)=>AS(t,e,n).then(r=>{switch(r._tag){case ut:return r.effect_instruction_i0;case at:throw FS(r.effect_instruction_i0)}})),AS=Bi((t,e,n)=>new Promise(r=>{const s=CS(e);s&&r(s);const i=RS(t)(e);i.addObserver(o=>{r(o)}),n?.signal!==void 0&&(n.signal.aborted?i.unsafeInterruptAsFork(i.id()):n.signal.addEventListener("abort",()=>{i.unsafeInterruptAsFork(i.id())},{once:!0}))}));class PS{context;runtimeFlags;fiberRefs;constructor(e,n,r){this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return y(this,arguments)}}const xS=t=>new PS(t.context,t.runtimeFlags,t.fiberRefs),jS=pa(Ne,ha,fa),LS=xS({context:Ys(),runtimeFlags:jS,fiberRefs:a_()}),DS=NS(LS),qS=function(){const t=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends Ii{constructor(n){super(n?.message,n?.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,t,{value:n,enumerable:!1}))}toJSON(){return{...this[t],...this}}}}.BaseEffectError}(),US=t=>{const e={BaseEffectError:class extends qS{_tag=t}};return e.BaseEffectError.prototype.name=t,e.BaseEffectError},BS=T_,VS=DS;class KS extends US("ConfigParseError"){}const GS=t=>VS(BS({try:async()=>{const e=await fetch(t);if(!e.ok)throw new Error(`Failed to load config: ${e.status}`);const n=await e.text();return JS(n)},catch:e=>new KS({message:String(e)})}));function JS(t){const e={card:{},audio:{},background:{},scene:{},characters:{},finale:{},theme:{},timecapsule:{},storage:{}};let n="";const r=t.split(`
`);for(const s of r){const i=s.trim();if(!i||i.startsWith(";"))continue;if(i.startsWith("[")){n=i.slice(1,-1);continue}const[o,c]=i.split("=").map(a=>a.trim());if(n&&o&&c){let a=c;c==="true"?a=!0:c==="false"?a=!1:isNaN(Number(c))?c.startsWith('"')&&c.endsWith('"')&&(a=c.slice(1,-1)):a=Number(c),typeof a=="string"&&a.startsWith("#"),e[n]||(e[n]={}),e[n][o]=a}}return e}export{GS as l};
