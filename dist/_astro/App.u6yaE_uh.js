import{e as Y,d as u,f as b,i as h,j as R,E as oe,t as p,c as x,k,l as D,m as ae,s as A,n as se,o as ee,u as H,p as le,q as E,v as te,w as ce,x as de,y as ue}from"./web.CbF8GdTA.js";import{l as fe}from"./config.BPlqvCb2.js";var ge=p('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black text-white p-8"><div class=text-center><h1 class="text-2xl font-bold text-red-500 mb-4">Something went wrong</h1><pre class="bg-red-900/20 p-4 rounded text-left text-xs overflow-auto max-w-lg"></pre><button class="mt-6 px-4 py-2 bg-white text-black rounded hover:bg-gray-200">Reload');const he=t=>u(oe,{fallback:i=>(()=>{var l=b(ge),r=l.firstChild,o=r.firstChild,n=o.nextSibling,s=n.nextSibling;return h(n,()=>i.toString()),s.$$click=()=>window.location.reload(),R(),l})(),get children(){return t.children}});Y(["click"]);var me=p('<div><div class="bg-white p-8 rounded shadow-2xl max-w-md w-full text-center cursor-pointer transform hover:scale-105 transition-transform duration-300"><div class="text-4xl mb-4"></div><h2 class="text-2xl font-serif font-bold text-gray-800 mb-2">For <!$><!/></h2><p class="text-gray-500 text-sm">Tap to Open');const $e=t=>{const[i,l]=x(!1),r=()=>{l(!0),setTimeout(t.onOpen,1e3)};return(()=>{var o=b(me),n=o.firstChild,s=n.firstChild,c=s.nextSibling,d=c.firstChild,f=d.nextSibling,[$,m]=k(f.nextSibling);return n.$$click=r,h(s,()=>t.config.card.occasion==="valentine"?"üíå":"‚úâÔ∏è"),h(c,()=>t.config.card.to,$,m),D(()=>ae(o,`fixed inset-0 z-30 flex items-center justify-center transition-opacity duration-1000 ${i()?"opacity-0 pointer-events-none":"opacity-100"}`)),R(),o})()};Y(["click"]);var ve=p('<div class="fixed inset-0 z-0 bg-cover bg-center transition-all duration-1000"><div class="absolute inset-0 bg-black/40 backdrop-blur-sm">');const xe=t=>(()=>{var i=b(ve);return D(l=>A(i,"background-image",`url(${t.config.background.image})`)),i})(),be="modulepreload",pe=function(t){return"/"+t},re={},_e=function(i,l,r){let o=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");o=Promise.allSettled(l.map(d=>{if(d=pe(d),d in re)return;re[d]=!0;const f=d.endsWith(".css"),$=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${$}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":be,f||(m.as="script"),m.crossOrigin="",m.href=d,c&&m.setAttribute("nonce",c),document.head.appendChild(m),f)return new Promise((_,a)=>{m.addEventListener("load",_),m.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(s){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s}return o.then(s=>{for(const c of s||[])c.status==="rejected"&&n(c.reason);return i().catch(n)})};var we=p('<div class="fixed inset-0 z-10 w-full h-full"><canvas class="block w-full h-full touch-none">');const ke=t=>{let i,l;return se(()=>{i&&_e(async()=>{const{MusicBoxScene:r}=await import("./MusicBoxScene.CvQF2_Ls.js");return{MusicBoxScene:r}},[]).then(({MusicBoxScene:r})=>{l||(l=new r(i,t.config),l.play(),t.phase)})}),ee(()=>{l?.dispose()}),(()=>{var r=b(we),o=r.firstChild,n=i;return typeof n=="function"?H(n,o):i=o,r})()};var Se=p('<button class="p-3 bg-white/10 rounded-full hover:bg-white/20 active:scale-95 transition-all text-white backdrop-blur-md">'),ye=p("<span class=text-xs>‚è™"),Ce=p("<span class=text-xs>‚è©"),Ee=p('<div class="absolute bottom-14 left-1/2 -translate-x-1/2 bg-black/80 p-2 rounded-xl border border-white/10"><div class="h-24 w-1 bg-white/20 relative cursor-pointer"><div class="absolute bottom-0 left-0 w-full bg-pink-500">'),Te=p("<span class=text-xs>üèÅ"),Pe=p('<div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-40 bg-black/40 backdrop-blur-xl border border-white/10 rounded-full px-6 py-4 flex items-center gap-4 shadow-2xl"><div class="text-[10px] font-mono text-white/50 w-20 text-right"></div><div class="w-32 h-1 bg-white/10 rounded-full relative cursor-pointer group"><div class="absolute top-0 left-0 h-full bg-pink-500 rounded-full"></div><div class="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div></div><!$><!/><button class="w-12 h-12 bg-pink-500 rounded-full flex items-center justify-center text-white shadow-lg shadow-pink-500/30 hover:scale-105 active:scale-95 transition-all"></button><!$><!/><div class=relative><!$><!/><!$><!/></div><!$><!/>');function Le(t){if(!isFinite(t)||t<0)return"0:00";const i=Math.floor(t/60),l=Math.floor(t%60);return`${i}:${l.toString().padStart(2,"0")}`}const Me=t=>{const[i,l]=x(!1),[r,o]=x(!1);let n,s;const c=a=>{o(!0),$(a),a.target?.setPointerCapture?.(a.pointerId)},d=a=>{r()&&$(a)},f=()=>{o(!1)},$=a=>{if(!n)return;const g=n.getBoundingClientRect(),v=Math.max(0,Math.min(1,(a.clientX-g.left)/g.width));t.onSeek(v)},m=a=>{if(!s)return;const g=s.getBoundingClientRect(),v=1-Math.max(0,Math.min(1,(a.clientY-g.top)/g.height));t.onVolume(v)},_=a=>(()=>{var g=b(Se);return le(g,"click",a.onClick),h(g,()=>a.children),R(),g})();return(()=>{var a=b(Pe),g=a.firstChild,v=g.nextSibling,P=v.firstChild,B=P.nextSibling,L=v.nextSibling,[T,N]=k(L.nextSibling),F=T.nextSibling,W=F.nextSibling,[V,X]=k(W.nextSibling),M=V.nextSibling,J=M.firstChild,[U,K]=k(J.nextSibling),Q=U.nextSibling,[z,Z]=k(Q.nextSibling),e=M.nextSibling,[w,q]=k(e.nextSibling);h(g,()=>Le(t.currentTime)),v.$$pointerup=f,v.$$pointermove=d,v.$$pointerdown=c;var G=n;return typeof G=="function"?H(G,v):n=v,h(a,u(_,{get onClick(){return t.onRewind},get children(){return b(ye)}}),T,N),le(F,"click",t.onPlay),h(F,()=>t.isPlaying?"‚è∏":"‚ñ∂"),h(a,u(_,{get onClick(){return t.onForward},get children(){return b(Ce)}}),V,X),h(M,u(_,{onClick:()=>l(!i()),children:"üîä"}),U,K),h(M,u(E,{get when(){return i()},get children(){var y=b(Ee),C=y.firstChild,I=C.firstChild;C.$$click=m;var S=s;return typeof S=="function"?H(S,C):s=C,D(O=>A(I,"height",`${t.volume*100}%`)),R(),y}}),z,Z),h(a,u(_,{get onClick(){return t.onFinale},get children(){return b(Te)}}),w,q),D(y=>{var C=`${t.progress*100}%`,I=`${t.progress*100}%`;return C!==y.e&&A(P,"width",y.e=C),I!==y.t&&A(B,"left",y.t=I),y},{e:void 0,t:void 0}),R(),a})()};Y(["click","pointerdown","pointermove","pointerup"]);var Ie=p('<p class="mt-8 text-xs text-white/30">ID: <!$><!/>'),Re=p('<div class="fixed inset-0 z-40 bg-black/60 backdrop-blur-md flex flex-col items-center justify-center text-white text-center p-6 animate-in fade-in duration-1000"><h1 class="text-5xl font-serif font-bold mb-4 text-pink-500 animate-float"></h1><p class="text-xl text-white/80 mb-8"></p><div class="flex gap-4"><button class="px-6 py-3 bg-white/10 rounded-full hover:bg-white/20 transition">Replay</button><a href=/create class="px-6 py-3 bg-pink-600 rounded-full hover:bg-pink-500 transition font-bold">Create Your Own</a></div><!$><!/>');const De=t=>(()=>{var i=b(Re),l=i.firstChild,r=l.nextSibling,o=r.nextSibling,n=o.firstChild,s=o.nextSibling,[c,d]=k(s.nextSibling);return h(l,()=>t.config.finale.message),h(r,()=>t.config.finale.subtitle),n.$$click=()=>window.location.reload(),h(i,u(E,{get when(){return t.slug},get children(){var f=b(Ie),$=f.firstChild,m=$.nextSibling,[_,a]=k(m.nextSibling);return h(f,()=>t.slug,_,a),f}}),c,d),R(),i})();Y(["click"]);var Be=p('<div class="fixed inset-0 z-50 bg-[#050208] flex flex-col items-center justify-center text-white"><h1 class="text-3xl font-serif mb-4 animate-pulse">Hearth</h1><div class="w-48 h-1 bg-white/10 rounded-full overflow-hidden"><div class="h-full bg-pink-500 transition-all duration-300"></div></div><p class="mt-2 text-xs text-white/40 font-mono"><!$><!/>%');const Fe=()=>{const[t,i]=x(0);return te(()=>{const l=setInterval(()=>{i(r=>Math.min(100,r+5))},100);ee(()=>clearInterval(l))}),(()=>{var l=b(Be),r=l.firstChild,o=r.nextSibling,n=o.firstChild,s=o.nextSibling,c=s.firstChild,[d,f]=k(c.nextSibling);return d.nextSibling,h(s,t,d,f),D($=>A(n,"width",`${t()}%`)),l})()};var ze=p('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-xl text-white"><div class="text-center p-8 border border-white/10 rounded-2xl bg-white/5 max-w-md mx-4 animate-in fade-in zoom-in duration-500"><div class="text-5xl mb-6 animate-pulse">‚è≥</div><h2 class="text-2xl font-serif font-bold mb-4">Time Capsule</h2><p class="text-white/60 mb-8 leading-relaxed"></p><div class="text-3xl font-mono tabular-nums tracking-widest text-[#fbbf24] font-bold"></div><p class="mt-6 text-xs text-white/30 uppercase tracking-widest">Unlocks on <!$><!/>');const Oe=t=>{const[i,l]=x(""),[r,o]=x(!0);let n;const s=t.config.timecapsule?.unlock_date;if(!s)return r()&&(o(!1),t.onUnlock()),null;const c=new Date(s).getTime(),d=()=>{const f=Date.now(),$=c-f;if($<=0){o(!1),t.onUnlock(),clearInterval(n);return}const m=Math.floor($/(1e3*60*60*24)),_=Math.floor($%(1e3*60*60*24)/(1e3*60*60)),a=Math.floor($%(1e3*60*60)/(1e3*60)),g=Math.floor($%(1e3*60)/1e3);l(`${m}d ${_}h ${a}m ${g}s`)};return te(()=>{d(),n=setInterval(d,1e3)}),ee(()=>clearInterval(n)),r()?(()=>{var f=b(ze),$=f.firstChild,m=$.firstChild,_=m.nextSibling,a=_.nextSibling,g=a.nextSibling,v=g.nextSibling,P=v.firstChild,B=P.nextSibling,[L,T]=k(B.nextSibling);return h(a,()=>t.config.timecapsule?.locked_message||"This message is locked until the future."),h(g,i),h(v,()=>new Date(c).toLocaleDateString(),L,T),f})():null};var je=p('<div class="relative w-full h-full overflow-hidden select-none"><!$><!/><!$><!/>'),Ae=p("<audio preload=auto>");const Ue=t=>{const[i,l]=x(null),[r,o]=x("loading"),[n,s]=x(null),[c,d]=x(0),[f,$]=x(0),[m,_]=x(0),[a,g]=x(!1),[v,P]=x(.8),[B,L]=x(!1),[T,N]=x(!1);te(async()=>{try{const e=await fe(t.confPath||"/program.conf");l(e),e.timecapsule?.unlock_date&&new Date(e.timecapsule.unlock_date)>new Date?(N(!0),o("envelope")):setTimeout(()=>o("envelope"),800)}catch(e){console.error("Failed to load config:",e)}});const F=()=>{const e=document.getElementById("main-nav");e&&e.classList.add("hidden-nav")},W=()=>{const e=document.getElementById("main-nav");e&&e.classList.remove("hidden-nav")},V=()=>{"vibrate"in navigator&&navigator.vibrate([10,30,10]),F(),L(!0),o("opening"),setTimeout(()=>{const e=n();e&&i()?.audio.autoplay&&(e.volume=v(),e.play().catch(()=>{}),g(!0))},1200)},X=e=>{e==="playing"&&r()!=="playing"&&o("playing"),e==="finale"&&z()},M=()=>{const e=n();e&&(e.paused?(e.play().catch(()=>{}),g(!0)):(e.pause(),g(!1)))},J=()=>{const e=n();e&&(e.currentTime=Math.max(0,e.currentTime-10))},U=()=>{const e=n();e&&(e.currentTime=Math.min(e.duration||0,e.currentTime+10))},K=e=>{const w=n();w&&w.duration&&(w.currentTime=w.duration*e)},Q=e=>{P(e);const w=n();w&&(w.volume=e)},z=()=>{o("finale"),L(!1),W();const e=n();if(e){const w=setInterval(()=>{e.volume>.05?e.volume=Math.max(0,e.volume-.05):(e.pause(),clearInterval(w))},100)}},Z=e=>{s(e),e.volume=v(),e.addEventListener("timeupdate",()=>{e.duration&&(d(e.currentTime/e.duration),$(e.currentTime))}),e.addEventListener("loadedmetadata",()=>_(e.duration)),e.addEventListener("durationchange",()=>_(e.duration)),e.addEventListener("ended",()=>{i()?.audio.loop?(e.currentTime=0,e.play().catch(()=>{})):z()})};return u(he,{get children(){var e=b(je),w=e.firstChild,[q,G]=k(w.nextSibling),y=q.nextSibling,[C,I]=k(y.nextSibling);return h(e,u(E,{get when(){return r()==="loading"},get children(){return u(Fe,{})}}),q,G),h(e,u(E,{get when(){return i()},children:S=>[(()=>{var O=b(Ae);return H(Z,O),D(j=>{var ne=S().audio.src,ie=S().audio.loop;return ne!==j.e&&ce(O,"src",j.e=ne),ie!==j.t&&de(O,"loop",j.t=ie),j},{e:void 0,t:void 0}),O})(),u(xe,{get config(){return S()}}),u(E,{get when(){return T()},get children(){return u(Oe,{get config(){return S()},onUnlock:()=>N(!1)})}}),u(E,{get when(){return ue(()=>r()==="envelope")()&&!T()},get children(){return u($e,{get config(){return S()},onOpen:V})}}),u(E,{get when(){return B()},get children(){return u(ke,{get config(){return S()},get phase(){return r()},onPhaseChange:X})}}),u(E,{get when(){return r()==="playing"},get children(){return u(Me,{get config(){return S()},get isPlaying(){return a()},get progress(){return c()},get currentTime(){return f()},get duration(){return m()},get volume(){return v()},onPlay:M,onRewind:J,onForward:U,onSeek:K,onVolume:Q,onFinale:z})}}),u(E,{get when(){return r()==="finale"},get children(){return u(De,{get config(){return S()},get slug(){return t.slug}})}})]}),C,I),e}})};export{Ue as default};
